"use strict";(self.webpackChunkcrema=self.webpackChunkcrema||[]).push([[154],{53016:(e,a,t)=>{t.d(a,{Z:()=>o});t(72791);var l=t(2409),s=t(49389),r=t(80184);const o=e=>{let{label:a,name:t,required:o,required_text:n}=e;return(0,r.jsx)(l.Z.Item,{label:a,name:t,rules:[{required:o,message:n}],children:(0,r.jsx)(s.default,{})})}},68438:(e,a,t)=>{t.d(a,{Z:()=>o});var l=t(74569),s=t.n(l);s().defaults.baseURL="".concat("https://leapmotorca.uz/api"),s().interceptors.request.use((e=>{const a=(e=>{try{return localStorage.getItem(e)}catch(a){console.log("Error getting data")}})("lptoken"),t=null!==a?"Bearer ".concat(a):"";return e.headers.authorization=t,e}));const r=s(),o={async getData(e){const{data:a}=await r.get(e);return a},async getDataByID(e,a){const{data:t}=await r.get("".concat(e,"/").concat(a));return t},async postData(e,a){const{data:t}=await r.post(e,a);return t},async editData(e,a,t){const{data:l}=await r.put("".concat(e,"/").concat(t),a);return l},async deleteData(e,a){await r.delete("".concat(e,"/").concat(a))},async deleteImages(e,a){console.log("delete image",a),await r.delete(e,{data:a})}}},56154:(e,a,t)=>{t.r(a),t.d(a,{default:()=>Z});var l=t(72791),s=t(2409),r=t(50419),o=t(66106),n=t(30914),d=t(83734),i=t(87309),u=t(91933),c=t(68438),m=t(98986),g=t(57689),p=t(16030),h=t(77221),v=t(53016),b=t(80184);const f={name:"",tgId:"",role:"",region:"",dealer:""},Z=()=>{const[e]=s.Z.useForm(),a=(0,g.s0)(),{editId:t}=(0,p.v9)((e=>e.editData)),Z=(0,p.I0)(),[x,y]=(0,l.useState)([]),[j,I]=(0,l.useState)(!1),{data:w}=(0,u.useQuery)("get-region",(()=>c.Z.getData("/region"))),{mutate:S,data:D,isLoading:F,isSuccess:q}=(0,u.useMutation)((e=>{let{url:a,data:t}=e;return c.Z.postData(a,t)}),{onSuccess:()=>{r.ZP.success("Success")},onError:e=>{for(let a in e.response.data)r.ZP.error("".concat(a,": ").concat(e.response.data[a][0]))}}),{isLoading:E,data:L,refetch:P,isSuccess:V}=(0,u.useQuery)(["edit-tgbot",t],(()=>c.Z.getDataByID("/tgbot",t)),{enabled:!1}),{mutate:C,isLoading:R,data:k,isSuccess:M}=(0,u.useMutation)((e=>{let{url:a,data:t,id:l}=e;return c.Z.editData(a,t,l)}),{onSuccess:()=>{r.ZP.success("Success")},onError:e=>{for(let a in e.response.data)r.ZP.error("".concat(a,": ").concat(e.response.data[a][0]))}});(0,l.useEffect)((()=>{M&&Z({type:h.Pb,payload:""}),(q||M)&&a("/tgbot")}),[D,k]),(0,l.useEffect)((()=>{""!==t&&P()}),[t]),(0,l.useEffect)((()=>{""===t&&e.setFieldsValue(f)}),[]),(0,l.useEffect)((()=>{if(V){const a={name:L.name,tgId:L.tgId,role:L.role,region:L.region,dealer:L.dealer};"drive"===L.role?I(!0):I(!1),e.setFieldsValue(a)}}),[L]);(0,l.useEffect)((()=>{const a=JSON.parse(localStorage.getItem("myFormValues"));a&&(a.images=[],e.setFieldsValue(a));const t=()=>{localStorage.setItem("myFormValues",JSON.stringify(e.getFieldsValue()))};return window.addEventListener("beforeunload",t),()=>{localStorage.removeItem("editDataId"),localStorage.removeItem("myFormValues"),window.removeEventListener("beforeunload",t)}}),[]);const B=(0,l.useMemo)((()=>[{value:"all",label:"\u0412\u0441\u0435 \u0440\u043e\u043b\u0438"},{value:"drive",label:"\u0422\u0435\u0441\u0442-\u0434\u0440\u0430\u0439\u0432"},{value:"dealer",label:"\u0414\u0438\u043b\u0435\u0440"},{value:"order",label:"\u0417\u0430\u043a\u0430\u0437"}]),[]),Q=(0,l.useMemo)((()=>null===w||void 0===w?void 0:w.map((e=>({value:null===e||void 0===e?void 0:e.nameRu,label:null===e||void 0===e?void 0:e.nameRu})))),[w]),_=(0,l.useMemo)((()=>(console.log(w),null===x||void 0===x?void 0:x.map((e=>({value:null===e||void 0===e?void 0:e.nameRu,label:null===e||void 0===e?void 0:e.nameRu}))))),[x]);return(0,b.jsx)("div",{children:F||E||R?(0,b.jsx)(m.QP,{}):(0,b.jsxs)(s.Z,{form:e,name:"basic",labelCol:{span:24},wrapperCol:{span:24},style:{maxWidth:"100%"},initialValues:f,onFinish:e=>{const a={name:e.name,tgId:e.tgId,role:e.role,region:j?e.region:"",dealer:j?e.dealer:""};L?C({url:"/tgbot",data:a,id:t}):S({url:"/tgbot/",data:a})},onFinishFailed:e=>{console.log("Failed:",e)},autoComplete:"off",children:[(0,b.jsxs)(o.Z,{gutter:20,children:[(0,b.jsx)(n.Z,{span:12,children:(0,b.jsx)(v.Z,{required:!0,required_text:"\u0422\u0440\u0435\u0431\u0443\u0435\u0442\u0441\u044f \u0437\u0430\u043f\u043e\u043b\u043d\u0435\u043d\u0438\u0435",label:"\u0418\u043c\u044f \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f",name:"name"})}),(0,b.jsx)(n.Z,{span:12,children:(0,b.jsx)(v.Z,{required:!0,required_text:"\u0422\u0440\u0435\u0431\u0443\u0435\u0442\u0441\u044f \u0437\u0430\u043f\u043e\u043b\u043d\u0435\u043d\u0438\u0435",label:"\u0422\u0435\u043b\u0435\u0433\u0440\u0430\u043c\u043c\u0430 ID",name:"tgId"})})]}),(0,b.jsx)(o.Z,{gutter:20,children:(0,b.jsx)(n.Z,{span:24,children:(0,b.jsx)(s.Z.Item,{label:"\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0420\u043e\u043b\u044c",name:"role",rules:[{required:!0,message:"\u041f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430, \u0432\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0440\u043e\u043b\u044c"}],children:(0,b.jsx)(d.default,{style:{width:"100%"},onChange:e=>{I("drive"===e)},placeholder:"\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u043e\u0434\u043d\u0443 \u043c\u043e\u0434\u0435\u043b\u044c",optionLabelProp:"label",options:B})})})}),j&&(0,b.jsxs)(o.Z,{gutter:20,children:[(0,b.jsx)(n.Z,{span:12,children:(0,b.jsx)(s.Z.Item,{label:"\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u041e\u0431\u043b\u0430\u0441\u0442\u044c",name:"region",rules:[{required:!0,message:"\u041f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430, \u0432\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u043e\u0431\u043b\u0430\u0441\u0442\u044c"}],children:(0,b.jsx)(d.default,{style:{width:"100%"},onChange:e=>{const a=null===w||void 0===w?void 0:w.find((a=>a.nameRu===e));y(null===a||void 0===a?void 0:a.dealers),console.log(a)},placeholder:"\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u043e\u0434\u043d\u0443 \u043c\u043e\u0434\u0435\u043b\u044c",optionLabelProp:"label",options:Q})})}),(0,b.jsx)(n.Z,{span:12,children:(0,b.jsx)(s.Z.Item,{label:"\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0434\u0438\u043b\u0435\u0440\u044b",name:"dealer",rules:[{required:!0,message:"\u041f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430, \u0432\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0434\u0438\u043b\u0435\u0440\u044b"}],children:(0,b.jsx)(d.default,{style:{width:"100%"},placeholder:"\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u043e\u0434\u043d\u0443 \u0434\u0438\u043b\u0435\u0440\u044b",optionLabelProp:"label",options:_})})})]}),(0,b.jsx)(i.Z,{type:"primary",htmlType:"submit",style:{width:"100%",marginTop:"20px"},children:V?"Edit":"Add"})]})})}},30914:(e,a,t)=>{t.d(a,{Z:()=>l});const l=t(89752).Z}}]);
//# sourceMappingURL=154.fd4960f9.chunk.js.map