"use strict";(self.webpackChunkcrema=self.webpackChunkcrema||[]).push([[312],{68438:(e,a,t)=>{t.d(a,{Z:()=>n});var i=t(74569),s=t.n(i);s().defaults.baseURL="".concat("https://andijon.leapmotorca.uz/api"),s().interceptors.request.use((e=>{const a=(e=>{try{return localStorage.getItem(e)}catch(a){console.log("Error getting data")}})("lptoken"),t=null!==a?"Bearer ".concat(a):"";return e.headers.authorization=t,e}));const o=s(),n={async getData(e){const{data:a}=await o.get(e);return a},async getDataByID(e,a){const{data:t}=await o.get("".concat(e,"/").concat(a));return t},async postData(e,a){const{data:t}=await o.post(e,a);return t},async editData(e,a,t){const{data:i}=await o.put("".concat(e,"/").concat(t),a);return i},async deleteData(e,a){await o.delete("".concat(e,"/").concat(a))},async deleteImages(e,a){await o.delete(e,{data:a})}}},87884:(e,a,t)=>{t.r(a),t.d(a,{default:()=>I});var i=t(72791),s=t(2409),o=t(50419),n=t(66106),l=t(30914),r=t(93086),d=t(87309),u=t(91933),c=t(68438),m=t(98986),g=t(57689),p=t(16030),v=t(77221),f=t(80184);const h={mediaId:[""]},I=()=>{const[e]=s.Z.useForm(),a=(0,g.s0)(),{editId:t}=(0,p.v9)((e=>e.editData)),I=(0,p.I0)(),[w,y]=(0,i.useState)([]),[Z,F]=(0,i.useState)([]),[S,E]=(0,i.useState)({}),[b,D]=(0,i.useState)(!1),[j,P]=(0,i.useState)([]),{mutate:x,data:L,isLoading:V,isSuccess:C,error:O,isError:k}=(0,u.useMutation)((e=>{let{url:a,data:t}=e;return c.Z.postData(a,t)}),{onSuccess:()=>o.ZP.success("Success"),onError:e=>o.ZP.error(e.message)}),{mutate:M,data:R,isLoading:J,isSuccess:U}=(0,u.useMutation)((e=>{let{url:a,formData:t}=e;return c.Z.postData(a,t)}),{onError:e=>o.ZP.error(e.message,"Rasmning JPG,JPEG,PNG formatlariga ruxsat etilgan")}),{isLoading:z,data:B,refetch:G,isSuccess:N}=(0,u.useQuery)(["edit-filialInner",t],(()=>c.Z.getDataByID("/filialInner",t)),{enabled:!1}),{mutate:T,isLoading:_,data:q,isSuccess:A,error:Q,isError:H}=(0,u.useMutation)((e=>{let{url:a,data:t,id:i}=e;return c.Z.editData(a,t,i)}),{onError:e=>o.ZP.error(e.message)}),{mutate:W}=(0,u.useMutation)((e=>{let{url:a,ids:t}=e;return c.Z.deleteImages(a,t)}),{onSuccess:()=>o.ZP.success("Success"),onError:e=>o.ZP.error(e.message)});(0,i.useEffect)((()=>{let e=[];if(A&&I({type:v.Pb,payload:""}),null===j||void 0===j||j.map((a=>{N&&null!==a&&void 0!==a&&a.uid&&e.push(null===a||void 0===a?void 0:a.uid)})),N&&e.length>0){W({url:"/medias",ids:{ids:e}})}(C||A)&&a("/filialInner")}),[L,q]),(0,i.useEffect)((()=>{k&&o.ZP.error(O.message),H&&o.ZP.error(Q.message)}),[O,Q]),(0,i.useEffect)((()=>{""!==t&&G()}),[t]),(0,i.useEffect)((()=>{""===t&&e.setFieldsValue(h)}),[]),(0,i.useEffect)((()=>{const a=[];for(let e=0;e<(null===B||void 0===B||null===(t=B.images)||void 0===t?void 0:t.length);e++){var t,i,s,o,n;const l={uid:null===B||void 0===B||null===(i=B.images[e])||void 0===i?void 0:i._id,name:null===B||void 0===B||null===(s=B.images[e])||void 0===s?void 0:s.name,location:null===B||void 0===B||null===(o=B.images[e])||void 0===o?void 0:o.path,status:"done",url:"".concat("https://andijon.leapmotorca.uz/api","/").concat(null===B||void 0===B||null===(n=B.images[e])||void 0===n?void 0:n.path)};a.push(l)}if(N){const t={mediaId:a};y(a),e.setFieldsValue(t)}}),[B]),(0,i.useEffect)((()=>{let e=[],a=[];a=U?Z.concat(R):[...Z];const i=[];a.map((e=>{var a;null!==e&&void 0!==e&&null!==(a=e.originFileObj)&&void 0!==a&&a.uid||i.push(e)})),!N&&R?null===R||void 0===R||R.map((a=>{e.push(null===a||void 0===a?void 0:a._id)})):i.map((a=>{null!==a&&void 0!==a&&a.uid?e.push(null===a||void 0===a?void 0:a.uid):e.push(null===a||void 0===a?void 0:a._id)}));const s={mediaId:e};U&&!N?x({url:"/filialInner",data:s}):(b||U)&&T({url:"/filialInner",data:s,id:t})}),[R,S]);(0,i.useEffect)((()=>{const a=JSON.parse(localStorage.getItem("myFormValues"));a&&(a.images=[],e.setFieldsValue(a));const t=()=>{localStorage.setItem("myFormValues",JSON.stringify(e.getFieldsValue()))};return window.addEventListener("beforeunload",t),()=>{localStorage.removeItem("editDataId"),localStorage.removeItem("myFormValues"),window.removeEventListener("beforeunload",t)}}),[]);return(0,f.jsx)("div",{children:J||V||z||_?(0,f.jsx)(m.QP,{}):(0,f.jsxs)(s.Z,{form:e,name:"basic",labelCol:{span:24},wrapperCol:{span:24},style:{maxWidth:"100%"},initialValues:h,onFinish:e=>{const a=new FormData;let t=!1;null===w||void 0===w||w.map((e=>{var i;N?null!==e&&void 0!==e&&null!==(i=e.originFileObj)&&void 0!==i&&i.uid?(t=!0,a.append("media",null===e||void 0===e?void 0:e.originFileObj),D(!1),F(w)):(t=!1,F(w),D(!0)):(t=!0,a.append("media",null===e||void 0===e?void 0:e.originFileObj))})),t&&!U&&M({url:"/medias",formData:a}),E(e)},onFinishFailed:e=>{console.log("Failed:",e)},autoComplete:"off",children:[(0,f.jsx)(n.Z,{gutter:20,children:(0,f.jsx)(l.Z,{span:12,children:(0,f.jsx)(s.Z.Item,{label:"\u0418\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435 \u043b\u043e\u0433\u043e\u0442\u0438\u043f\u0430",name:"mediaId",rules:[{required:!0,message:"\u0422\u0440\u0435\u0431\u0443\u0435\u0442\u0441\u044f \u0437\u0430\u0433\u0440\u0443\u0437\u043a\u0430 \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u044f \u043b\u043e\u0433\u043e\u0442\u0438\u043f\u0430"}],children:(0,f.jsx)(r.Z,{maxCount:2,fileList:w,listType:"picture-card",onChange:a=>{let{fileList:t}=a;y(t),e.setFieldsValue({mediaId:t})},onPreview:async e=>{let a=e.url;a||(a=await new Promise((a=>{const t=new FileReader;t.readAsDataURL(e.originFileObj),t.onload=()=>a(t.result)})));const t=new Image;t.src=a;const i=window.open(a);null===i||void 0===i||i.document.write(t.outerHTML)},beforeUpload:()=>!1,onRemove:e=>{if(N){const a=[...j];a.push(e),P(a)}},children:w.length>1?"":"Upload"})})})}),(0,f.jsx)(d.Z,{type:"primary",htmlType:"submit",style:{width:"100%"},children:N?"Edit":"Add"})]})})}}}]);
//# sourceMappingURL=312.20371f40.chunk.js.map