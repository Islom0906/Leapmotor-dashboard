"use strict";(self.webpackChunkcrema=self.webpackChunkcrema||[]).push([[243],{68438:function(e,n,i){i.d(n,{Z:function(){return d}});var t=i(74165),r=i(15861),o=i(74569),a=i.n(o);a().defaults.baseURL="".concat("https://leapmotorca.uz/api"),a().interceptors.request.use((function(e){var n=function(e){try{return localStorage.getItem(e)}catch(n){console.log("Error getting data")}}("lptoken"),i=null!==n?"Bearer ".concat(n):"";return e.headers.authorization=i,e}));var u=a(),d={getData:function(e){return(0,r.Z)((0,t.Z)().mark((function n(){var i,r;return(0,t.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,u.get(e);case 2:return i=n.sent,r=i.data,n.abrupt("return",r);case 5:case"end":return n.stop()}}),n)})))()},getDataByID:function(e,n){return(0,r.Z)((0,t.Z)().mark((function i(){var r,o;return(0,t.Z)().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,u.get("".concat(e,"/").concat(n));case 2:return r=i.sent,o=r.data,i.abrupt("return",o);case 5:case"end":return i.stop()}}),i)})))()},postData:function(e,n){return(0,r.Z)((0,t.Z)().mark((function i(){var r,o;return(0,t.Z)().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,u.post(e,n);case 2:return r=i.sent,o=r.data,i.abrupt("return",o);case 5:case"end":return i.stop()}}),i)})))()},editData:function(e,n,i){return(0,r.Z)((0,t.Z)().mark((function r(){var o,a;return(0,t.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,u.put("".concat(e,"/").concat(i),n);case 2:return o=t.sent,a=o.data,t.abrupt("return",a);case 5:case"end":return t.stop()}}),r)})))()},deleteData:function(e,n){return(0,r.Z)((0,t.Z)().mark((function i(){return(0,t.Z)().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,u.delete("".concat(e,"/").concat(n));case 2:case"end":return i.stop()}}),i)})))()},deleteImages:function(e,n){return(0,r.Z)((0,t.Z)().mark((function i(){return(0,t.Z)().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return console.log("delete image",n),i.next=3,u.delete(e,{ids:["64f0ffa5883c58f0433c44d9"]});case 3:case"end":return i.stop()}}),i)})))()}}},32243:function(e,n,i){i.r(n);var t=i(74165),r=i(15861),o=i(29439),a=i(72791),u=i(2409),d=i(50419),l=i(66106),s=i(30914),c=i(93086),v=i(87309),f=i(22645),m=i(91933),p=i(68438),g=i(98986),Z=i(57689),h=i(16030),b=i(77221),x=i(80184),j={mediaLogoId:"",mediaBrandId:"",mediaVideoId:""};n.default=function(){var e=u.Z.useForm(),n=(0,o.Z)(e,1)[0],i=(0,Z.s0)(),F=(0,h.v9)((function(e){return e.editData})).editId,w=(0,h.I0)(),I=(0,a.useState)([]),S=(0,o.Z)(I,2),L=S[0],O=S[1],y=(0,a.useState)([]),E=(0,o.Z)(y,2),P=E[0],D=E[1],V=(0,a.useState)([]),B=(0,o.Z)(V,2),k=B[0],_=B[1],C=(0,a.useState)({}),U=(0,o.Z)(C,2),R=U[0],z=U[1],M=(0,a.useState)(!1),T=(0,o.Z)(M,2),q=T[0],J=T[1],G=(0,a.useState)({}),N=(0,o.Z)(G,2),A=N[0],Q=N[1],H=(0,a.useState)({}),W=(0,o.Z)(H,2),K=W[0],X=W[1],Y=(0,a.useState)({}),$=(0,o.Z)(Y,2),ee=$[0],ne=$[1];console.log(k);var ie=(0,m.useMutation)((function(e){var n=e.url,i=e.data;return p.Z.postData(n,i)}),{onSuccess:function(){return d.ZP.success("Success")},onError:function(e){return d.ZP.error(e.message)}}),te=ie.mutate,re=ie.data,oe=ie.isLoading,ae=ie.isSuccess,ue=ie.error,de=ie.isError,le=(0,m.useMutation)((function(e){var n=e.url,i=e.formData;return p.Z.postData(n,i)}),{onError:function(e){return d.ZP.error(e.message,"Rasmning JPG,JPEG,PNG formatlariga ruxsat etilgan")}}),se=le.mutate,ce=le.data,ve=le.isLoading,fe=le.isSuccess,me=(0,m.useQuery)(["edit-banner",F],(function(){return p.Z.getData("/banner")}),{enabled:!1}),pe=me.isLoading,ge=me.data,Ze=me.refetch,he=me.isSuccess,be=(0,m.useMutation)((function(e){var n=e.url,i=e.data,t=e.id;return p.Z.editData(n,i,t)}),{onError:function(e){return d.ZP.error(e.message)}}),xe=be.mutate,je=be.isLoading,Fe=be.data,we=be.isSuccess,Ie=be.error,Se=be.isError,Le=(0,m.useMutation)((function(e){var n=e.url,i=e.ids;return p.Z.deleteImages(n,i)}),{onSuccess:function(){return d.ZP.success("Success")},onError:function(e){return d.ZP.error(e.message)}}).mutate;(0,a.useEffect)((function(){var e=[];(we&&w({type:b.Pb,payload:""}),he&&null!==A&&void 0!==A&&A.uid&&e.push(null===A||void 0===A?void 0:A.uid),he&&null!==K&&void 0!==K&&K.uid&&e.push(null===K||void 0===K?void 0:K.uid),he&&null!==ee&&void 0!==ee&&ee.uid&&e.push(null===ee||void 0===ee?void 0:ee.uid),he&&(null!==A&&void 0!==A&&A.uid||null!==K&&void 0!==K&&K.uid||ee)&&A.length>0)&&Le({url:"/medias",ids:{ids:e}});(ae||we)&&i("/banner")}),[re,Fe]),(0,a.useEffect)((function(){de&&d.ZP.error(ue.message),Se&&d.ZP.error(Ie.message)}),[ue,Ie]),(0,a.useEffect)((function(){""!==F&&Ze()}),[F]),(0,a.useEffect)((function(){""===F&&n.setFieldsValue(j)}),[]),(0,a.useEffect)((function(){var e,i,t,r,o,a,u,d,l,s=[{uid:null===ge||void 0===ge||null===(e=ge.imageLogo)||void 0===e?void 0:e._id,name:null===ge||void 0===ge||null===(i=ge.imageLogo)||void 0===i?void 0:i.name,status:"done",url:"".concat("https://leapmotorca.uz/api","/").concat(null===ge||void 0===ge||null===(t=ge.imageLogo)||void 0===t?void 0:t.path)}],c=[{uid:null===ge||void 0===ge||null===(r=ge.imageBrand)||void 0===r?void 0:r._id,name:null===ge||void 0===ge||null===(o=ge.imageBrand)||void 0===o?void 0:o.name,status:"done",url:"".concat("https://leapmotorca.uz/api","/").concat(null===ge||void 0===ge||null===(a=ge.imageBrand)||void 0===a?void 0:a.path)}],v=[{uid:null===ge||void 0===ge||null===(u=ge.videoBanner)||void 0===u?void 0:u._id,name:null===ge||void 0===ge||null===(d=ge.videoBanner)||void 0===d?void 0:d.name,status:"done",url:"".concat("https://leapmotorca.uz/api","/").concat(null===ge||void 0===ge||null===(l=ge.videoBanner)||void 0===l?void 0:l.path)}];if(he){var f={mediaLogoId:s,mediaBrandId:c,mediaVideoId:v};O(s),D(c),_(v),n.setFieldsValue(f)}}),[ge]),(0,a.useEffect)((function(){var e,n,i,t,r,o,a,u,d,l,s,c,v,f,m,p,g="",Z="",h="";if(he&&fe&&null!==(e=L[0])&&void 0!==e&&null!==(n=e.originFileObj)&&void 0!==n&&n.uid)g=null===(a=ce[0])||void 0===a?void 0:a._id;else if(he){var b;g=null===(b=L[0])||void 0===b?void 0:b.uid}if(he&&fe&&null!==(i=P[0])&&void 0!==i&&null!==(t=i.originFileObj)&&void 0!==t&&t.uid)Z=3===ce.length?null===(u=ce[1])||void 0===u?void 0:u._id:2===ce.length?null===(d=ce[1])||void 0===d?void 0:d._id:null===(l=ce[0])||void 0===l?void 0:l._id;else if(he){var x;Z=null===(x=P[0])||void 0===x?void 0:x.uid}if(he&&fe&&null!==(r=k[0])&&void 0!==r&&null!==(o=r.originFileObj)&&void 0!==o&&o.uid)h=3===ce.length?null===(s=ce[2])||void 0===s?void 0:s._id:2===ce.length?null===(c=ce[1])||void 0===c?void 0:c._id:null===(v=ce[0])||void 0===v?void 0:v._id;else if(he){var j;h=null===(j=k[0])||void 0===j?void 0:j.uid}!he&&ce&&(g=null===(f=ce[0])||void 0===f?void 0:f._id,Z=null===(m=ce[1])||void 0===m?void 0:m._id,h=null===(p=ce[2])||void 0===p?void 0:p._id);var w={mediaLogoId:g,mediaBrandId:Z,mediaVideoId:h};console.log(w),fe&&!he?te({url:"/banner",data:w}):(q||fe)&&xe({url:"/banner",data:w,id:F})}),[ce,R]);(0,a.useEffect)((function(){var e=JSON.parse(localStorage.getItem("myFormValues"));e&&(e.images=[],n.setFieldsValue(e));var i=function(){localStorage.setItem("myFormValues",JSON.stringify(n.getFieldsValue()))};return window.addEventListener("beforeunload",i),function(){localStorage.removeItem("editDataId"),localStorage.removeItem("myFormValues"),window.removeEventListener("beforeunload",i)}}),[]);var Oe=function(){var e=(0,r.Z)((0,t.Z)().mark((function e(n){var i,r,o;return(0,t.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=n.url){e.next=5;break}return e.next=4,new Promise((function(e){var i=new FileReader;i.readAsDataURL(n.originFileObj),i.onload=function(){return e(i.result)}}));case 4:i=e.sent;case 5:(r=new Image).src=i,null===(o=window.open(i))||void 0===o||o.document.write(r.outerHTML);case 9:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}();return(0,x.jsx)("div",{children:ve||oe||pe||je?(0,x.jsx)(g.QP,{}):(0,x.jsxs)(u.Z,{form:n,name:"basic",labelCol:{span:24},wrapperCol:{span:24},style:{maxWidth:"100%"},initialValues:j,onFinish:function(e){var n,i,t,r,o,a,u,d,l,s,c,v,f,m,p,g,Z,h,b=new FormData,x=!1;if(he)if(null!==(n=L[0])&&void 0!==n&&null!==(i=n.originFileObj)&&void 0!==i&&i.uid&&null!==(t=P[0])&&void 0!==t&&null!==(r=t.originFileObj)&&void 0!==r&&r.uid&&null!==(o=k[0])&&void 0!==o&&null!==(a=o.originFileObj)&&void 0!==a&&a.uid)x=!0,b.append("media",null===(f=L[0])||void 0===f?void 0:f.originFileObj),b.append("media",null===(m=P[0])||void 0===m?void 0:m.originFileObj),b.append("media",null===(p=k[0])||void 0===p?void 0:p.originFileObj),J(!1);else if(null!==(u=L[0])&&void 0!==u&&null!==(d=u.originFileObj)&&void 0!==d&&d.uid){var j;x=!0,b.append("media",null===(j=L[0])||void 0===j?void 0:j.originFileObj),J(!1)}else if(null!==(l=P[0])&&void 0!==l&&null!==(s=l.originFileObj)&&void 0!==s&&s.uid){var F;x=!0,b.append("media",null===(F=P[0])||void 0===F?void 0:F.originFileObj),J(!1)}else if(null!==(c=k[0])&&void 0!==c&&null!==(v=c.originFileObj)&&void 0!==v&&v.uid){var w;x=!0,b.append("media",null===(w=k[0])||void 0===w?void 0:w.originFileObj),J(!1)}else x=!1,J(!0);else x=!0,b.append("media",null===(g=L[0])||void 0===g?void 0:g.originFileObj),b.append("media",null===(Z=P[0])||void 0===Z?void 0:Z.originFileObj),b.append("media",null===(h=k[0])||void 0===h?void 0:h.originFileObj);x&&!fe&&se({url:"/medias",formData:b}),z(e)},onFinishFailed:function(e){console.log("Failed:",e)},autoComplete:"off",children:[(0,x.jsxs)(l.Z,{gutter:20,children:[(0,x.jsx)(s.Z,{span:12,children:(0,x.jsx)(u.Z.Item,{label:"\u0418\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435 \u043b\u043e\u0433\u043e\u0442\u0438\u043f\u0430",name:"mediaLogoId",rules:[{required:!0,message:"\u0422\u0440\u0435\u0431\u0443\u0435\u0442\u0441\u044f \u0437\u0430\u0433\u0440\u0443\u0437\u043a\u0430 \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u044f \u043b\u043e\u0433\u043e\u0442\u0438\u043f\u0430"}],children:(0,x.jsx)(f.Z,{rotationSlider:!0,children:(0,x.jsx)(c.Z,{maxCount:1,fileList:L,listType:"picture-card",onChange:function(e){var i=e.fileList;O(i),n.setFieldsValue({mediaLogoId:i})},onPreview:Oe,beforeUpload:function(){return!1},onRemove:function(e){he&&Q(e)},children:L.length>0?"":"Upload"})})})}),(0,x.jsx)(s.Z,{span:12,children:(0,x.jsx)(u.Z.Item,{label:"\u0418\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435 \u0431\u0440\u0435\u043d\u0434\u0430",name:"mediaBrandId",rules:[{required:!0,message:"\u0422\u0440\u0435\u0431\u0443\u0435\u0442\u0441\u044f \u0437\u0430\u0433\u0440\u0443\u0437\u043a\u0430 \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u044f \u0431\u0440\u0435\u043d\u0434\u0430"}],children:(0,x.jsx)(f.Z,{rotationSlider:!0,children:(0,x.jsx)(c.Z,{maxCount:1,fileList:P,listType:"picture-card",onChange:function(e){var i=e.fileList;D(i),n.setFieldsValue({mediaBrandId:i})},onPreview:Oe,beforeUpload:function(){return!1},onRemove:function(e){he&&X(e)},children:P.length>0?"":"Upload"})})})})]}),(0,x.jsx)(l.Z,{gutter:20,children:(0,x.jsx)(s.Z,{span:24,children:(0,x.jsx)(u.Z.Item,{label:"\u0411\u0430\u043d\u043d\u0435\u0440\u043d\u043e\u0435 \u0432\u0438\u0434\u0435\u043e",name:"mediaBrandId",rules:[{required:!0,message:"\u0422\u0440\u0435\u0431\u0443\u0435\u0442\u0441\u044f \u0432\u0438\u0434\u0435\u043e\u0431\u0430\u043d\u043d\u0435\u0440"}],children:(0,x.jsx)(c.Z,{maxCount:1,accept:"video/*",fileList:k,listType:"picture-card",onChange:function(e){var i=e.fileList;_(i),n.setFieldsValue({mediaVideoId:i})},onPreview:Oe,beforeUpload:function(){return!1},onRemove:function(e){he&&ne(e)},children:k.length>0?"":"Upload"})})})}),(0,x.jsx)(v.Z,{type:"primary",htmlType:"submit",style:{width:"100%"},children:he?"Edit":"Add"})]})})}}}]);
//# sourceMappingURL=243.a4f83038.chunk.js.map