"use strict";(self.webpackChunkcrema=self.webpackChunkcrema||[]).push([[452],{68438:function(e,n,i){i.d(n,{Z:function(){return l}});var t=i(74165),r=i(15861),o=i(74569),a=i.n(o);a().defaults.baseURL="".concat("https://leapmotorca.uz/api"),a().interceptors.request.use((function(e){var n=function(e){try{return localStorage.getItem(e)}catch(n){console.log("Error getting data")}}("lptoken"),i=null!==n?"Bearer ".concat(n):"";return e.headers.authorization=i,e}));var u=a(),l={getData:function(e){return(0,r.Z)((0,t.Z)().mark((function n(){var i,r;return(0,t.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,u.get(e);case 2:return i=n.sent,r=i.data,n.abrupt("return",r);case 5:case"end":return n.stop()}}),n)})))()},getDataByID:function(e,n){return(0,r.Z)((0,t.Z)().mark((function i(){var r,o;return(0,t.Z)().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,u.get("".concat(e,"/").concat(n));case 2:return r=i.sent,o=r.data,i.abrupt("return",o);case 5:case"end":return i.stop()}}),i)})))()},postData:function(e,n){return(0,r.Z)((0,t.Z)().mark((function i(){var r,o;return(0,t.Z)().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,u.post(e,n);case 2:return r=i.sent,o=r.data,i.abrupt("return",o);case 5:case"end":return i.stop()}}),i)})))()},editData:function(e,n,i){return(0,r.Z)((0,t.Z)().mark((function r(){var o,a;return(0,t.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,u.put("".concat(e,"/").concat(i),n);case 2:return o=t.sent,a=o.data,t.abrupt("return",a);case 5:case"end":return t.stop()}}),r)})))()},deleteData:function(e,n){return(0,r.Z)((0,t.Z)().mark((function i(){return(0,t.Z)().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,u.delete("".concat(e,"/").concat(n));case 2:case"end":return i.stop()}}),i)})))()},deleteImages:function(e,n){return(0,r.Z)((0,t.Z)().mark((function i(){return(0,t.Z)().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return console.log("delete image",n),i.next=3,u.delete(e,{ids:["64f0ffa5883c58f0433c44d9"]});case 3:case"end":return i.stop()}}),i)})))()}}},72452:function(e,n,i){i.r(n);var t=i(74165),r=i(15861),o=i(29439),a=i(72791),u=i(2409),l=i(50419),d=i(66106),s=i(30914),c=i(83734),m=i(49389),v=i(13344),f=i(93086),p=i(87309),g=i(91933),Z=i(68438),h=i(98986),x=i(57689),b=i(16030),j=i(77221),w=i(22645),I=i(80184),F={model:"",position:"",name:"",colorMediaId:"",mediaId:"",price:null,commentPrice:""};n.default=function(){var e=u.Z.useForm(),n=(0,o.Z)(e,1)[0],i=(0,x.s0)(),S=(0,b.v9)((function(e){return e.editData})).editId,y=(0,b.I0)(),P=(0,a.useState)([]),D=(0,o.Z)(P,2),E=D[0],L=D[1],O=(0,a.useState)([]),k=(0,o.Z)(O,2),M=k[0],V=k[1],C=(0,a.useState)({}),_=(0,o.Z)(C,2),q=_[0],R=_[1],U=(0,a.useState)({}),T=(0,o.Z)(U,2),z=T[0],J=T[1],Q=(0,a.useState)({}),B=(0,o.Z)(Q,2),G=B[0],N=B[1],A=(0,a.useState)(!1),H=(0,o.Z)(A,2),W=H[0],K=H[1],X=(0,a.useState)(""),Y=(0,o.Z)(X,2),$=Y[0],ee=Y[1],ne=(0,g.useQuery)("get-model",(function(){return Z.Z.getData("/product")}),{enabled:!1}),ie=ne.data,te=ne.refetch,re=(0,g.useQuery)("get-position",(function(){return Z.Z.getData("/position?model=".concat($))}),{enabled:!1}),oe=re.data,ae=re.refetch,ue=(0,g.useMutation)((function(e){var n=e.url,i=e.formData;return Z.Z.postData(n,i)}),{onError:function(e){return l.ZP.error(e.message,"Rasmning JPG,JPEG,PNG formatlariga ruxsat etilgan")}}),le=ue.mutate,de=ue.data,se=ue.isLoading,ce=ue.isSuccess,me=(0,g.useMutation)((function(e){var n=e.url,i=e.data;return Z.Z.postData(n,i)}),{onSuccess:function(){l.ZP.success("Success")},onError:function(e){l.ZP.error(e.message)}}),ve=me.mutate,fe=me.data,pe=me.isLoading,ge=me.isSuccess,Ze=(0,g.useQuery)(["edit-postion",S],(function(){return Z.Z.getDataByID("/exterior",S)}),{enabled:!1}),he=Ze.isLoading,xe=Ze.data,be=Ze.refetch,je=Ze.isSuccess,we=(0,g.useMutation)((function(e){var n=e.url,i=e.data,t=e.id;return Z.Z.editData(n,i,t)}),{onSuccess:function(){l.ZP.success("Success")},onError:function(e){l.ZP.error(e.message)}}),Ie=we.mutate,Fe=we.isLoading,Se=we.data,ye=we.isSuccess,Pe=(0,g.useMutation)((function(e){var n=e.url,i=e.ids;return Z.Z.deleteImages(n,i)}),{onSuccess:function(){return l.ZP.success("Success")},onError:function(e){return l.ZP.error(e.message)}}).mutate;(0,a.useEffect)((function(){$&&ae();var e=n.getFieldsValue();(null===xe||void 0===xe?void 0:xe.model)!==(null===e||void 0===e?void 0:e.model)&&n.setFieldsValue({position:""})}),[$]),(0,a.useEffect)((function(){var e=[];(ye&&y({type:j.Pb,payload:""}),je&&null!==q&&void 0!==q&&q.uid&&e.push(null===q||void 0===q?void 0:q.uid),je&&null!==z&&void 0!==z&&z.uid&&e.push(null===q||void 0===q?void 0:q.uid),je&&(null!==q&&void 0!==q&&q.uid||null!==z&&void 0!==z&&z.uid))&&Pe({url:"/medias",ids:{ids:e}});(ge||ye)&&i("/exterior")}),[fe,Se]),(0,a.useEffect)((function(){""!==S&&be()}),[S]),(0,a.useEffect)((function(){""===S&&n.setFieldsValue(F),L([]),te()}),[]),(0,a.useEffect)((function(){var e,i,t,r,o,a,u=[{uid:null===xe||void 0===xe||null===(e=xe.image)||void 0===e?void 0:e._id,name:null===xe||void 0===xe||null===(i=xe.image)||void 0===i?void 0:i.name,status:"done",url:"".concat("https://leapmotorca.uz/api","/").concat(null===xe||void 0===xe||null===(t=xe.image)||void 0===t?void 0:t.path)}],l=[{uid:null===xe||void 0===xe||null===(r=xe.colorImage)||void 0===r?void 0:r._id,name:null===xe||void 0===xe||null===(o=xe.colorImage)||void 0===o?void 0:o.name,status:"done",url:"".concat("https://leapmotorca.uz/api","/").concat(null===xe||void 0===xe||null===(a=xe.colorImage)||void 0===a?void 0:a.path)}];if(je){var d={model:xe.model,position:xe.position,name:xe.name,price:0===xe.price?null:xe.price,commentPrice:xe.commentPrice,colorMediaId:l,mediaId:u};ee(xe.model),L(u),V(l),n.setFieldsValue(d)}}),[xe]),(0,a.useEffect)((function(){var e,n,i,t,r,o,a,u,l,d="",s="";if(je&&ce&&null!==(e=E[0])&&void 0!==e&&null!==(n=e.originFileObj)&&void 0!==n&&n.uid)d=null===(r=de[0])||void 0===r?void 0:r._id;else if(je){var c;d=null===(c=E[0])||void 0===c?void 0:c.uid}if(je&&ce&&null!==(i=M[0])&&void 0!==i&&null!==(t=i.originFileObj)&&void 0!==t&&t.uid)s=2===de.length?null===(o=de[1])||void 0===o?void 0:o._id:null===(a=de[0])||void 0===a?void 0:a._id;else if(je){var m;s=null===(m=M[0])||void 0===m?void 0:m.uid}!je&&de&&(d=null===(u=de[0])||void 0===u?void 0:u._id,s=null===(l=de[1])||void 0===l?void 0:l._id);var v={model:G.model,position:G.position,name:G.name,price:null===G.price||""===G.price?0:G.price,commentPrice:G.commentPrice,colorMediaId:s,mediaId:d};console.log("render"),ce&&!je?ve({url:"/exterior",data:v}):(W||ce)&&Ie({url:"/exterior",data:v,id:S})}),[de,G]);(0,a.useEffect)((function(){var e=JSON.parse(localStorage.getItem("myFormValues"));e&&(e.images=[],n.setFieldsValue(e));var i=function(){localStorage.setItem("myFormValues",JSON.stringify(n.getFieldsValue()))};return window.addEventListener("beforeunload",i),function(){localStorage.removeItem("editDataId"),localStorage.removeItem("myFormValues"),window.removeEventListener("beforeunload",i)}}),[]);var De=(0,a.useMemo)((function(){return null===ie||void 0===ie?void 0:ie.map((function(e){return{value:null===e||void 0===e?void 0:e.model,label:null===e||void 0===e?void 0:e.model}}))}),[ie]),Ee=(0,a.useMemo)((function(){return null===oe||void 0===oe?void 0:oe.map((function(e){return{value:null===e||void 0===e?void 0:e.name,label:null===e||void 0===e?void 0:e.name}}))}),[oe]),Le=function(){var e=(0,r.Z)((0,t.Z)().mark((function e(n){var i,r,o;return(0,t.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=n.url){e.next=5;break}return e.next=4,new Promise((function(e){var i=new FileReader;i.readAsDataURL(n.originFileObj),i.onload=function(){return e(i.result)}}));case 4:i=e.sent;case 5:(r=new Image).src=i,null===(o=window.open(i))||void 0===o||o.document.write(r.outerHTML);case 9:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}();return(0,I.jsx)("div",{children:pe||he||Fe||se?(0,I.jsx)(h.QP,{}):(0,I.jsxs)(u.Z,{form:n,name:"basic",labelCol:{span:24},wrapperCol:{span:24},style:{maxWidth:"100%"},initialValues:F,onFinish:function(e){var n,i,t,r,o,a,u,l,d,s,c,m,v=new FormData,f=!1;if(je)if(null!==(n=E[0])&&void 0!==n&&null!==(i=n.originFileObj)&&void 0!==i&&i.uid&&null!==(t=M[0])&&void 0!==t&&null!==(r=t.originFileObj)&&void 0!==r&&r.uid)f=!0,v.append("media",null===(d=E[0])||void 0===d?void 0:d.originFileObj),v.append("media",null===(s=M[0])||void 0===s?void 0:s.originFileObj),K(!1);else if(null!==(o=E[0])&&void 0!==o&&null!==(a=o.originFileObj)&&void 0!==a&&a.uid){var p;f=!0,v.append("media",null===(p=E[0])||void 0===p?void 0:p.originFileObj),K(!1)}else if(null!==(u=M[0])&&void 0!==u&&null!==(l=u.originFileObj)&&void 0!==l&&l.uid){var g;f=!0,v.append("media",null===(g=M[0])||void 0===g?void 0:g.originFileObj),K(!1)}else f=!1,K(!0);else f=!0,v.append("media",null===(c=E[0])||void 0===c?void 0:c.originFileObj),v.append("media",null===(m=M[0])||void 0===m?void 0:m.originFileObj);f&&!ce&&le({url:"/medias",formData:v}),N(e)},onFinishFailed:function(e){console.log("Failed:",e)},autoComplete:"off",children:[(0,I.jsxs)(d.Z,{gutter:20,children:[(0,I.jsx)(s.Z,{span:12,children:(0,I.jsx)(u.Z.Item,{label:"\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u043c\u043e\u0434\u0435\u043b\u044c",name:"model",rules:[{required:!0,message:"\u041f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430, \u0432\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0441\u0432\u043e\u044e \u043c\u043e\u0434\u0435\u043b\u044c"}],children:(0,I.jsx)(c.Z,{style:{width:"100%"},onChange:function(e){ee(e)},placeholder:"\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u043e\u0434\u043d\u0443 \u043c\u043e\u0434\u0435\u043b\u044c",optionLabelProp:"label",options:De})})}),(0,I.jsx)(s.Z,{span:12,children:(0,I.jsx)(u.Z.Item,{label:"\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u043f\u043e\u0437\u0438\u0446\u0438\u044f",name:"position",rules:[{required:!0,message:"\u041f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430, \u0432\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0441\u0432\u043e\u044e \u043f\u043e\u0437\u0438\u0446\u0438\u044f"}],children:(0,I.jsx)(c.Z,{style:{width:"100%"},placeholder:"\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u043e\u0434\u043d\u0443 \u043f\u043e\u0437\u0438\u0446\u0438\u044f",optionLabelProp:"label",options:Ee})})})]}),(0,I.jsxs)(d.Z,{gutter:20,children:[(0,I.jsx)(s.Z,{span:24,children:(0,I.jsx)(u.Z.Item,{label:"\u042d\u043a\u0441\u0442\u0435\u0440\u044c\u0435\u0440",name:"name",rules:[{required:!0,message:"\u041f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430, \u0432\u0432\u0435\u0434\u0438\u0442\u0435 \u042d\u043a\u0441\u0442\u0435\u0440\u044c\u0435\u0440"}],children:(0,I.jsx)(m.Z,{})})}),(0,I.jsx)(s.Z,{span:12,children:(0,I.jsx)(u.Z.Item,{label:"\u0426\u0435\u043d\u0430, (\u043d\u0435 \u0442\u0440\u0435\u0431\u0443\u0435\u0442\u0441\u044f)",name:"price",children:(0,I.jsx)(v.Z,{style:{width:"100%"}})})}),(0,I.jsx)(s.Z,{span:12,children:(0,I.jsx)(u.Z.Item,{label:"\u041a\u043e\u043c\u043c\u0435\u043d\u0442\u0430\u0440\u0438\u0439 \u0426\u0435\u043d\u0430, (\u043d\u0435 \u0442\u0440\u0435\u0431\u0443\u0435\u0442\u0441\u044f)",name:"commentPrice",children:(0,I.jsx)(m.Z,{})})})]}),(0,I.jsxs)(d.Z,{gutter:20,children:[(0,I.jsx)(s.Z,{span:12,children:(0,I.jsx)(u.Z.Item,{label:"\u0418\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435 \u043b\u043e\u0433\u043e\u0442\u0438\u043f\u0430",name:"mediaId",rules:[{required:!0,message:"\u0422\u0440\u0435\u0431\u0443\u0435\u0442\u0441\u044f \u0437\u0430\u0433\u0440\u0443\u0437\u043a\u0430 \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u044f \u0431\u0430\u043d\u043d\u0435\u0440"}],children:(0,I.jsx)(w.Z,{children:(0,I.jsx)(f.Z,{maxCount:1,fileList:E,listType:"picture-card",onChange:function(e){var i=e.fileList;L(i),n.setFieldsValue({mediaId:i})},onPreview:Le,beforeUpload:function(){return!1},onRemove:function(e){je&&R(e)},children:E.length>0?"":"Upload"})})})}),(0,I.jsx)(s.Z,{span:12,children:(0,I.jsx)(u.Z.Item,{label:"\u0418\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435 \u043b\u043e\u0433\u043e\u0442\u0438\u043f\u0430",name:"colorMediaId",rules:[{required:!0,message:"\u0422\u0440\u0435\u0431\u0443\u0435\u0442\u0441\u044f \u0437\u0430\u0433\u0440\u0443\u0437\u043a\u0430 \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u044f \u0446\u0432\u0435\u0442"}],children:(0,I.jsx)(w.Z,{children:(0,I.jsx)(f.Z,{maxCount:1,fileList:M,listType:"picture-card",onChange:function(e){var i=e.fileList;V(i),n.setFieldsValue({colorMediaId:i})},onPreview:Le,beforeUpload:function(){return!1},onRemove:function(e){je&&J(e)},children:M.length>0?"":"Upload"})})})})]}),(0,I.jsx)(p.Z,{type:"primary",htmlType:"submit",style:{width:"100%",marginTop:"20px"},children:je?"Edit":"Add"})]})})}}}]);
//# sourceMappingURL=452.99b668b6.chunk.js.map