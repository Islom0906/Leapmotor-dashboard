"use strict";(self.webpackChunkcrema=self.webpackChunkcrema||[]).push([[70],{68438:(e,i,l)=>{l.d(i,{Z:()=>d});var o=l(74569),a=l.n(o);a().defaults.baseURL="".concat("https://leapmotorca.uz/api"),a().interceptors.request.use((e=>{const i=(e=>{try{return localStorage.getItem(e)}catch(i){console.log("Error getting data")}})("lptoken"),l=null!==i?"Bearer ".concat(i):"";return e.headers.authorization=l,e}));const t=a(),d={async getData(e){const{data:i}=await t.get(e);return i},async getDataByID(e,i){const{data:l}=await t.get("".concat(e,"/").concat(i));return l},async postData(e,i){const{data:l}=await t.post(e,i);return l},async editData(e,i,l){const{data:o}=await t.put("".concat(e,"/").concat(l),i);return o},async deleteData(e,i){await t.delete("".concat(e,"/").concat(i))},async deleteImages(e,i){console.log("delete image",i),await t.delete(e,{data:i})}}},15070:(e,i,l)=>{l.r(i),l.d(i,{default:()=>F});var o=l(72791),a=l(2409),t=l(50419),d=l(66106),n=l(30914),s=l(83734),r=l(49389),u=l(13344),c=l(93086),m=l(87309),v=l(91933),p=l(68438),g=l(98986),h=l(57689),f=l(16030),x=l(77221),b=l(68117),j=l(80184);const Z={model:"",position:"",exterior:"",name:"",colorMediaId:"",mediaId:"",price:null},F=()=>{const[e]=a.Z.useForm(),i=(0,h.s0)(),{editId:l}=(0,f.v9)((e=>e.editData)),F=(0,f.I0)(),[I,y]=(0,o.useState)([]),[w,S]=(0,o.useState)([]),[D,P]=(0,o.useState)({}),[E,L]=(0,o.useState)({}),[O,V]=(0,o.useState)({}),[M,C]=(0,o.useState)(!1),[q,_]=(0,o.useState)(""),[R,U]=(0,o.useState)(""),{data:k,refetch:Q}=(0,v.useQuery)("get-model",(()=>p.Z.getData("/product")),{enabled:!1}),{data:T,refetch:z}=(0,v.useQuery)("get-position",(()=>p.Z.getData("/position?model=".concat(q))),{enabled:!1}),{data:J,refetch:B}=(0,v.useQuery)("get-exterior",(()=>p.Z.getData("/exterior?model=".concat(q,"&position=").concat(R))),{enabled:!1}),{mutate:G,data:N,isLoading:A,isSuccess:H}=(0,v.useMutation)((e=>{let{url:i,formData:l}=e;return p.Z.postData(i,l)}),{onError:e=>t.ZP.error(e.message,"Rasmning JPG,JPEG,PNG formatlariga ruxsat etilgan")}),{mutate:W,data:K,isLoading:X,isSuccess:Y}=(0,v.useMutation)((e=>{let{url:i,data:l}=e;return p.Z.postData(i,l)}),{onSuccess:()=>{t.ZP.success("Success")},onError:e=>{t.ZP.error(e.message)}}),{isLoading:$,data:ee,refetch:ie,isSuccess:le}=(0,v.useQuery)(["edit-postion",l],(()=>p.Z.getDataByID("/interior",l)),{enabled:!1}),{mutate:oe,isLoading:ae,data:te,isSuccess:de}=(0,v.useMutation)((e=>{let{url:i,data:l,id:o}=e;return p.Z.editData(i,l,o)}),{onSuccess:()=>{t.ZP.success("Success")},onError:e=>{t.ZP.error(e)}}),{mutate:ne}=(0,v.useMutation)((e=>{let{url:i,ids:l}=e;return p.Z.deleteImages(i,l)}),{onSuccess:()=>t.ZP.success("Success"),onError:e=>t.ZP.error(e.message)});(0,o.useEffect)((()=>{q&&z();const i=e.getFieldsValue();(null===ee||void 0===ee?void 0:ee.model)!==(null===i||void 0===i?void 0:i.model)&&(e.setFieldsValue({position:""}),e.setFieldsValue({exterior:""}))}),[q]),(0,o.useEffect)((()=>{R&&B();const i=e.getFieldsValue();(null===ee||void 0===ee?void 0:ee.position)!==(null===i||void 0===i?void 0:i.position)&&e.setFieldsValue({exterior:""}),console.log("rener")}),[R]),(0,o.useEffect)((()=>{let e=[];if(de&&F({type:x.Pb,payload:""}),le&&null!==D&&void 0!==D&&D.uid&&e.push(null===D||void 0===D?void 0:D.uid),le&&null!==E&&void 0!==E&&E.uid&&e.push(null===E||void 0===E?void 0:E.uid),le&&(null!==D&&void 0!==D&&D.uid||null!==E&&void 0!==E&&E.uid)){ne({url:"/medias",ids:{ids:e}})}(Y||de)&&i("/interior")}),[K,te]),(0,o.useEffect)((()=>{""!==l&&ie()}),[l]),(0,o.useEffect)((()=>{""===l&&e.setFieldsValue(Z),y([]),Q()}),[]),(0,o.useEffect)((()=>{var i,l,o,a,t,d;const n=[{uid:null===ee||void 0===ee||null===(i=ee.image)||void 0===i?void 0:i._id,name:null===ee||void 0===ee||null===(l=ee.image)||void 0===l?void 0:l.name,status:"done",url:"".concat("https://leapmotorca.uz/api","/").concat(null===ee||void 0===ee||null===(o=ee.image)||void 0===o?void 0:o.path)}],s=[{uid:null===ee||void 0===ee||null===(a=ee.colorImage)||void 0===a?void 0:a._id,name:null===ee||void 0===ee||null===(t=ee.colorImage)||void 0===t?void 0:t.name,status:"done",url:"".concat("https://leapmotorca.uz/api","/").concat(null===ee||void 0===ee||null===(d=ee.colorImage)||void 0===d?void 0:d.path)}];if(le){const i={model:ee.model,position:ee.position,exterior:ee.exterior,name:ee.name,price:0===ee.price?null:ee.price,colorMediaId:s,mediaId:n};_(ee.model),U(ee.position),y(n),S(s),e.setFieldsValue(i)}}),[ee]),(0,o.useEffect)((()=>{var e,i,o,a;let t="",d="";var n,s,r,u,c;if(le&&H&&null!==(e=I[0])&&void 0!==e&&null!==(i=e.originFileObj)&&void 0!==i&&i.uid)t=null===(n=N[0])||void 0===n?void 0:n._id;else if(le){var m;t=null===(m=I[0])||void 0===m?void 0:m.uid}if(le&&H&&null!==(o=w[0])&&void 0!==o&&null!==(a=o.originFileObj)&&void 0!==a&&a.uid)d=2===N.length?null===(s=N[1])||void 0===s?void 0:s._id:null===(r=N[0])||void 0===r?void 0:r._id;else if(le){var v;d=null===(v=w[0])||void 0===v?void 0:v.uid}!le&&N&&(t=null===(u=N[0])||void 0===u?void 0:u._id,d=null===(c=N[1])||void 0===c?void 0:c._id);const p={model:O.model,position:O.position,exterior:O.exterior,name:O.name,price:null===O.price||""===O.price?0:O.price,colorMediaId:d,mediaId:t};console.log("render"),H&&!le?W({url:"/interior",data:p}):(M||H)&&oe({url:"/interior",data:p,id:l})}),[N,O]);(0,o.useEffect)((()=>{const i=JSON.parse(localStorage.getItem("myFormValues"));i&&(i.images=[],e.setFieldsValue(i));const l=()=>{localStorage.setItem("myFormValues",JSON.stringify(e.getFieldsValue()))};return window.addEventListener("beforeunload",l),()=>{localStorage.removeItem("editDataId"),localStorage.removeItem("myFormValues"),window.removeEventListener("beforeunload",l)}}),[]);const se=(0,o.useMemo)((()=>null===k||void 0===k?void 0:k.map((e=>({value:null===e||void 0===e?void 0:e.model,label:null===e||void 0===e?void 0:e.model})))),[k]),re=(0,o.useMemo)((()=>null===T||void 0===T?void 0:T.map((e=>({value:null===e||void 0===e?void 0:e.name,label:null===e||void 0===e?void 0:e.name})))),[T]),ue=(0,o.useMemo)((()=>null===J||void 0===J?void 0:J.map((e=>({value:null===e||void 0===e?void 0:e.name,label:null===e||void 0===e?void 0:e.name})))),[J]),ce=async e=>{let i=e.url;i||(i=await new Promise((i=>{const l=new FileReader;l.readAsDataURL(e.originFileObj),l.onload=()=>i(l.result)})));const l=new Image;l.src=i;const o=window.open(i);null===o||void 0===o||o.document.write(l.outerHTML)};return(0,j.jsx)("div",{children:X||$||ae||A?(0,j.jsx)(g.QP,{}):(0,j.jsxs)(a.Z,{form:e,name:"basic",labelCol:{span:24},wrapperCol:{span:24},style:{maxWidth:"100%"},initialValues:Z,onFinish:e=>{const i=new FormData;let l=!1;var o,a,t,d,n,s,r,u,c,m,v,p;if(le)if(null!==(o=I[0])&&void 0!==o&&null!==(a=o.originFileObj)&&void 0!==a&&a.uid&&null!==(t=w[0])&&void 0!==t&&null!==(d=t.originFileObj)&&void 0!==d&&d.uid)l=!0,i.append("media",null===(c=I[0])||void 0===c?void 0:c.originFileObj),i.append("media",null===(m=w[0])||void 0===m?void 0:m.originFileObj),C(!1);else if(null!==(n=I[0])&&void 0!==n&&null!==(s=n.originFileObj)&&void 0!==s&&s.uid){var g;l=!0,i.append("media",null===(g=I[0])||void 0===g?void 0:g.originFileObj),C(!1)}else if(null!==(r=w[0])&&void 0!==r&&null!==(u=r.originFileObj)&&void 0!==u&&u.uid){var h;l=!0,i.append("media",null===(h=w[0])||void 0===h?void 0:h.originFileObj),C(!1)}else l=!1,C(!0);else l=!0,i.append("media",null===(v=I[0])||void 0===v?void 0:v.originFileObj),i.append("media",null===(p=w[0])||void 0===p?void 0:p.originFileObj);l&&!H&&G({url:"/medias",formData:i}),V(e)},onFinishFailed:e=>{console.log("Failed:",e)},autoComplete:"off",children:[(0,j.jsxs)(d.Z,{gutter:20,children:[(0,j.jsx)(n.Z,{span:12,children:(0,j.jsx)(a.Z.Item,{label:"\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u043c\u043e\u0434\u0435\u043b\u044c",name:"model",rules:[{required:!0,message:"\u041f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430, \u0432\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0441\u0432\u043e\u044e \u043c\u043e\u0434\u0435\u043b\u044c"}],children:(0,j.jsx)(s.default,{style:{width:"100%"},onChange:e=>{_(e)},placeholder:"\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u043e\u0434\u043d\u0443 \u043c\u043e\u0434\u0435\u043b\u044c",optionLabelProp:"label",options:se})})}),(0,j.jsx)(n.Z,{span:12,children:(0,j.jsx)(a.Z.Item,{label:"\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u043f\u043e\u0437\u0438\u0446\u0438\u044f",name:"position",rules:[{required:!0,message:"\u041f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430, \u0432\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0441\u0432\u043e\u044e \u043f\u043e\u0437\u0438\u0446\u0438\u044f"}],children:(0,j.jsx)(s.default,{style:{width:"100%"},onChange:e=>{U(e)},placeholder:"\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u043e\u0434\u043d\u0443 \u043f\u043e\u0437\u0438\u0446\u0438\u044f",optionLabelProp:"label",options:re})})})]}),(0,j.jsxs)(d.Z,{gutter:20,children:[(0,j.jsx)(n.Z,{span:12,children:(0,j.jsx)(a.Z.Item,{label:"\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u042d\u043a\u0441\u0442\u0435\u0440\u044c\u0435\u0440",name:"exterior",rules:[{required:!0,message:"\u041f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430, \u0432\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0441\u0432\u043e\u0439 \u044d\u043a\u0441\u0442\u0435\u0440\u044c\u0435\u0440"}],children:(0,j.jsx)(s.default,{style:{width:"100%"},placeholder:"\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u043e\u0434\u043d\u0443 \u044d\u043a\u0441\u0442\u0435\u0440\u044c\u0435\u0440",optionLabelProp:"label",options:ue})})}),(0,j.jsx)(n.Z,{span:12,children:(0,j.jsx)(a.Z.Item,{label:"\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0418\u043d\u0442\u0435\u0440\u044c\u0435\u0440",name:"name",rules:[{required:!0,message:"\u041f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430, \u0432\u0432\u0435\u0434\u0438\u0442\u0435 \u0418\u043d\u0442\u0435\u0440\u044c\u0435\u0440"}],children:(0,j.jsx)(r.default,{})})}),(0,j.jsx)(n.Z,{span:24,children:(0,j.jsx)(a.Z.Item,{label:"\u0426\u0435\u043d\u0430, (\u043d\u0435 \u0442\u0440\u0435\u0431\u0443\u0435\u0442\u0441\u044f)",name:"price",children:(0,j.jsx)(u.Z,{style:{width:"100%"}})})})]}),(0,j.jsxs)(d.Z,{gutter:20,children:[(0,j.jsx)(n.Z,{span:12,children:(0,j.jsx)(a.Z.Item,{label:"\u0418\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435 \u0431\u0430\u043d\u043d\u0435\u0440",name:"mediaId",rules:[{required:!0,message:"\u0422\u0440\u0435\u0431\u0443\u0435\u0442\u0441\u044f \u0437\u0430\u0433\u0440\u0443\u0437\u043a\u0430 \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u044f \u0431\u0430\u043d\u043d\u0435\u0440"}],children:(0,j.jsx)(b.Z,{children:(0,j.jsx)(c.Z,{maxCount:1,fileList:I,listType:"picture-card",onChange:i=>{let{fileList:l}=i;y(l),e.setFieldsValue({mediaId:l})},onPreview:ce,beforeUpload:()=>!1,onRemove:e=>{le&&P(e)},children:I.length>0?"":"Upload"})})})}),(0,j.jsx)(n.Z,{span:12,children:(0,j.jsx)(a.Z.Item,{label:"\u0418\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435 \u0446\u0432\u0435\u0442",name:"colorMediaId",rules:[{required:!0,message:"\u0422\u0440\u0435\u0431\u0443\u0435\u0442\u0441\u044f \u0437\u0430\u0433\u0440\u0443\u0437\u043a\u0430 \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u044f \u0446\u0432\u0435\u0442"}],children:(0,j.jsx)(b.Z,{children:(0,j.jsx)(c.Z,{maxCount:1,fileList:w,listType:"picture-card",onChange:i=>{let{fileList:l}=i;S(l),e.setFieldsValue({colorMediaId:l})},onPreview:ce,beforeUpload:()=>!1,onRemove:e=>{le&&L(e)},children:w.length>0?"":"Upload"})})})})]}),(0,j.jsx)(m.Z,{type:"primary",htmlType:"submit",style:{width:"100%",marginTop:"20px"},children:le?"Edit":"Add"})]})})}}}]);
//# sourceMappingURL=70.c05683a3.chunk.js.map