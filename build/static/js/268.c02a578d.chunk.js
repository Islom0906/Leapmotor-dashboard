"use strict";(self.webpackChunkcrema=self.webpackChunkcrema||[]).push([[268],{68438:(e,t,a)=>{a.d(t,{Z:()=>n});var i=a(74569),s=a.n(i);s().defaults.baseURL="".concat("https://leapmotorca.uz/api"),s().interceptors.request.use((e=>{const t=(e=>{try{return localStorage.getItem(e)}catch(t){console.log("Error getting data")}})("lptoken"),a=null!==t?"Bearer ".concat(t):"";return e.headers.authorization=a,e}));const l=s(),n={async getData(e){const{data:t}=await l.get(e);return t},async getDataByID(e,t){const{data:a}=await l.get("".concat(e,"/").concat(t));return a},async postData(e,t){const{data:a}=await l.post(e,t);return a},async editData(e,t,a){const{data:i}=await l.put("".concat(e,"/").concat(a),t);return i},async deleteData(e,t){await l.delete("".concat(e,"/").concat(t))},async deleteImages(e,t){console.log("delete image",t),await l.delete(e,{data:t})}}},94268:(e,t,a)=>{a.r(t),a.d(t,{default:()=>I});var i=a(72791),s=a(2409),l=a(50419),n=a(66106),o=a(30914),d=a(83734),r=a(49389),u=a(13344),c=a(83099),m=a(87309),p=a(93086),g=a(91933),v=a(68438),h=a(98986),f=a(57689),Z=a(16030),j=a(77221),x=a(68747),y=a(68117),b=a(80184);const w={model:null,name:"",info:"",price:null,includedList:[""],mediaId:""},I=()=>{const[e]=s.Z.useForm(),t=(0,f.s0)(),{editId:a}=(0,Z.v9)((e=>e.editData)),I=(0,Z.I0)(),[S,F]=(0,i.useState)([]),[D,E]=(0,i.useState)({}),[L,P]=(0,i.useState)(!1),[C,V]=(0,i.useState)({}),[M,k]=(0,i.useState)(""),{data:O,refetch:z}=(0,g.useQuery)("get-model",(()=>v.Z.getData("/product")),{enabled:!1}),{mutate:q,data:R,isLoading:B,isSuccess:J}=(0,g.useMutation)((e=>{let{url:t,formData:a}=e;return v.Z.postData(t,a)}),{onError:e=>l.ZP.error(e.message,"Rasmning JPG,JPEG,PNG formatlariga ruxsat etilgan")}),{mutate:N,data:Q,isLoading:T,isSuccess:U}=(0,g.useMutation)((e=>{let{url:t,data:a}=e;return v.Z.postData(t,a)}),{onSuccess:()=>{l.ZP.success("Success")},onError:e=>{l.ZP.error(e.message)}}),{isLoading:_,data:A,refetch:G,isSuccess:H}=(0,g.useQuery)(["edit-postion",a],(()=>v.Z.getDataByID("/position",a)),{enabled:!1}),{mutate:K,isLoading:W,data:X,isSuccess:Y}=(0,g.useMutation)((e=>{let{url:t,data:a,id:i}=e;return v.Z.editData(t,a,i)}),{onSuccess:()=>{l.ZP.success("Success")},onError:e=>{l.ZP.error(e)}}),{mutate:$}=(0,g.useMutation)((e=>{let{url:t,ids:a}=e;return v.Z.deleteImages(t,a)}),{onSuccess:()=>l.ZP.success("Success"),onError:e=>l.ZP.error(e.message)}),{data:ee,isSuccess:te,refetch:ae}=(0,g.useQuery)("position-get-by-model",(()=>v.Z.getData("/position?model=".concat(M))),{enabled:!1,onError:e=>{l.ZP.error(e)}});(0,i.useEffect)((()=>{if(te&&ee.length>0){var t,a,i,s,l,n;const o=[{uid:null===(t=ee[0])||void 0===t||null===(a=t.image)||void 0===a?void 0:a._id,name:null===(i=ee[0])||void 0===i||null===(s=i.image)||void 0===s?void 0:s.name,status:"done",url:"".concat("https://leapmotorca.uz/api","/").concat(null===(l=ee[0])||void 0===l||null===(n=l.image)||void 0===n?void 0:n.path)}];F(o),e.setFieldsValue({mediaId:o})}else F([]),e.setFieldsValue({mediaId:[]})}),[ee]),(0,i.useEffect)((()=>{M&&ae()}),[M]),(0,i.useEffect)((()=>{let e=[];if(Y&&I({type:j.Pb,payload:""}),H&&null!==C&&void 0!==C&&C.uid&&e.push(null===C||void 0===C?void 0:C.uid),H&&null!==C&&void 0!==C&&C.uid){$({url:"/medias",ids:{ids:e}})}(U||Y)&&t("/position")}),[Q,X]),(0,i.useEffect)((()=>{""!==a&&G()}),[a]),(0,i.useEffect)((()=>{""===a&&e.setFieldsValue(w),F([]),z()}),[]),(0,i.useEffect)((()=>{var t,a,i;const s=[{uid:null===A||void 0===A||null===(t=A.image)||void 0===t?void 0:t._id,name:null===A||void 0===A||null===(a=A.image)||void 0===a?void 0:a.name,status:"done",url:"".concat("https://leapmotorca.uz/api","/").concat(null===A||void 0===A||null===(i=A.image)||void 0===i?void 0:i.path)}];if(H){const t={model:A.model,name:A.name,info:A.info,price:A.price,includedList:A.includedList,mediaId:s};F(s),e.setFieldsValue(t)}}),[A]),(0,i.useEffect)((()=>{var e,t;let i="";var s,l;if(H&&J&&null!==(e=S[0])&&void 0!==e&&null!==(t=e.originFileObj)&&void 0!==t&&t.uid)i=null===(s=R[0])||void 0===s?void 0:s._id;else if(H||M&&ee.length>0){var n;i=null===(n=S[0])||void 0===n?void 0:n.uid}!H&&R&&(i=null===(l=R[0])||void 0===l?void 0:l._id);const o={model:D.model,name:D.name,info:D.info,price:D.price,includedList:D.includedList,mediaId:i};J&&!H?N({url:"/position",data:o}):L||J?K({url:"/position",data:o,id:a}):!J&&!H&&M&&ee.length>0&&N({url:"/position",data:o})}),[R,D]);(0,i.useEffect)((()=>{const t=JSON.parse(localStorage.getItem("myFormValues"));t&&(t.images=[],e.setFieldsValue(t));const a=()=>{localStorage.setItem("myFormValues",JSON.stringify(e.getFieldsValue()))};return window.addEventListener("beforeunload",a),()=>{localStorage.removeItem("editDataId"),localStorage.removeItem("myFormValues"),window.removeEventListener("beforeunload",a)}}),[]);const ie=(0,i.useMemo)((()=>null===O||void 0===O?void 0:O.map((e=>({value:null===e||void 0===e?void 0:e.model,label:null===e||void 0===e?void 0:e.model})))),[O]);return(0,b.jsx)("div",{children:T||_||W||B?(0,b.jsx)(h.QP,{}):(0,b.jsxs)(s.Z,{form:e,name:"basic",labelCol:{span:24},wrapperCol:{span:24},style:{maxWidth:"100%"},initialValues:w,onFinish:e=>{const t=new FormData;let a=!1;var i,s,l,n;H?null!==(i=S[0])&&void 0!==i&&null!==(s=i.originFileObj)&&void 0!==s&&s.uid?(a=!0,t.append("media",null===(l=S[0])||void 0===l?void 0:l.originFileObj),P(!1)):(a=!1,P(!0)):M&&ee.length>0?(a=!1,P(!1)):(a=!0,t.append("media",null===(n=S[0])||void 0===n?void 0:n.originFileObj));a&&!J&&q({url:"/medias",formData:t}),E(e)},onFinishFailed:e=>{console.log("Failed:",e)},autoComplete:"off",children:[(0,b.jsxs)(n.Z,{gutter:20,children:[(0,b.jsx)(o.Z,{span:12,children:(0,b.jsx)(s.Z.Item,{label:"\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u043c\u043e\u0434\u0435\u043b\u044c",name:"model",rules:[{required:!0,message:"\u041f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430, \u0432\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0441\u0432\u043e\u044e \u043c\u043e\u0434\u0435\u043b\u044c"}],children:(0,b.jsx)(d.default,{style:{width:"100%"},onChange:e=>{k(e)},placeholder:"\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u043e\u0434\u043d\u0443 \u043c\u043e\u0434\u0435\u043b\u044c",optionLabelProp:"label",options:ie})})}),(0,b.jsx)(o.Z,{span:12,children:(0,b.jsx)(s.Z.Item,{label:"\u041f\u043e\u0437\u0438\u0446\u0438\u044f",name:"name",rules:[{required:!0,message:"\u041f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430, \u0432\u0432\u0435\u0434\u0438\u0442\u0435 \u043f\u043e\u0437\u0438\u0446\u0438\u044e"}],children:(0,b.jsx)(r.default,{})})})]}),(0,b.jsxs)(n.Z,{gutter:20,children:[(0,b.jsx)(o.Z,{span:12,children:(0,b.jsx)(s.Z.Item,{label:"\u041f\u0440\u0435\u0434\u0443\u043f\u0440\u0435\u0436\u0434\u0435\u043d\u0438\u0435, (\u043d\u0435 \u0442\u0440\u0435\u0431\u0443\u0435\u0442\u0441\u044f)",name:"info",children:(0,b.jsx)(r.default,{})})}),(0,b.jsx)(o.Z,{span:12,children:(0,b.jsx)(s.Z.Item,{label:"\u0426\u0435\u043d\u0430",name:"price",rules:[{required:!0,message:"\u0412\u044b \u0434\u043e\u043b\u0436\u043d\u044b \u0432\u0432\u0435\u0441\u0442\u0438 \u0446\u0435\u043d\u0443"}],children:(0,b.jsx)(u.Z,{style:{width:"100%"}})})})]}),(0,b.jsx)(s.Z.List,{name:"includedList",children:(e,t)=>{let{add:a,remove:i}=t;return(0,b.jsxs)(b.Fragment,{children:[e.map(((e,t)=>(0,b.jsx)("div",{style:{marginBottom:20},children:(0,b.jsxs)(c.Z,{align:"start",children:[(0,b.jsx)(s.Z.Item,{label:"\u041a\u0430\u043a\u043e\u0432\u044b \u043f\u0440\u0435\u0438\u043c\u0443\u0449\u0435\u0441\u0442\u0432\u0430 \u044d\u0442\u043e\u0439 \u043f\u043e\u0437\u0438\u0446\u0438\u0438? ".concat(t+1),name:[e.name],rules:[{required:!0,message:"\u0422\u0440\u0435\u0431\u0443\u0435\u0442\u0441\u044f \u0441\u0442\u0440\u043e\u043a\u0430"}],style:{width:"100%"},children:(0,b.jsx)(r.default,{})}),(0,b.jsx)(x.Z,{onClick:()=>i(e.name)})]})},e.fieldKey))),(0,b.jsx)(s.Z.Item,{children:(0,b.jsx)(m.Z,{type:"dashed",onClick:()=>a(),block:!0,children:"Add Item"})})]})}}),(0,b.jsx)(s.Z.Item,{label:"\u0418\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435 \u043b\u043e\u0433\u043e\u0442\u0438\u043f\u0430",name:"mediaId",rules:[{required:!0,message:"\u0422\u0440\u0435\u0431\u0443\u0435\u0442\u0441\u044f \u0437\u0430\u0433\u0440\u0443\u0437\u043a\u0430 \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u044f \u0431\u0430\u043d\u043d\u0435\u0440"}],children:(0,b.jsx)(y.Z,{children:(0,b.jsx)(p.Z,{maxCount:1,fileList:S,listType:"picture-card",onChange:t=>{let{fileList:a}=t;F(a),e.setFieldsValue({mediaId:a})},onPreview:async e=>{let t=e.url;t||(t=await new Promise((t=>{const a=new FileReader;a.readAsDataURL(e.originFileObj),a.onload=()=>t(a.result)})));const a=new Image;a.src=t;const i=window.open(t);null===i||void 0===i||i.document.write(a.outerHTML)},beforeUpload:()=>!1,onRemove:e=>{k(""),H&&V(e)},children:S.length>0?"":"Upload"})})}),(0,b.jsx)(m.Z,{type:"primary",htmlType:"submit",style:{width:"100%",marginTop:"20px"},children:H?"Edit":"Add"})]})})}},68747:(e,t,a)=>{a.d(t,{Z:()=>d});var i=a(1413),s=a(72791);const l={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M696 480H328c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h368c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8z"}},{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}}]},name:"minus-circle",theme:"outlined"};var n=a(54291),o=function(e,t){return s.createElement(n.Z,(0,i.Z)((0,i.Z)({},e),{},{ref:t,icon:l}))};o.displayName="MinusCircleOutlined";const d=s.forwardRef(o)}}]);
//# sourceMappingURL=268.c02a578d.chunk.js.map