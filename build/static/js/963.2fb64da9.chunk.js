"use strict";(self.webpackChunkcrema=self.webpackChunkcrema||[]).push([[963],{68438:(e,t,i)=>{i.d(t,{Z:()=>o});var a=i(74569),l=i.n(a);l().defaults.baseURL="".concat("https://leapmotorca.uz/api"),l().interceptors.request.use((e=>{const t=(e=>{try{return localStorage.getItem(e)}catch(t){console.log("Error getting data")}})("lptoken"),i=null!==t?"Bearer ".concat(t):"";return e.headers.authorization=i,e}));const n=l(),o={async getData(e){const{data:t}=await n.get(e);return t},async getDataByID(e,t){const{data:i}=await n.get("".concat(e,"/").concat(t));return i},async postData(e,t){const{data:i}=await n.post(e,t);return i},async editData(e,t,i){const{data:a}=await n.put("".concat(e,"/").concat(i),t);return a},async deleteData(e,t){await n.delete("".concat(e,"/").concat(t))},async deleteImages(e,t){await n.delete(e,{data:t})}}},17963:(e,t,i)=>{i.r(t),i.d(t,{default:()=>I});var a=i(72791),l=i(2409),n=i(50419),o=i(66106),s=i(30914),d=i(83734),r=i(49389),u=i(13344),c=i(93086),m=i(87309),p=i(91933),v=i(68438),g=i(98986),h=i(57689),f=i(16030),x=i(77221),b=i(68747),Z=i(80184);const j={model:"",position:"",exterior:"",interior:"",name:"",price:null,bonus:"",includeComment:"",mainMediaId:"",bannerMediaId:"",includes:[]},I=()=>{const[e]=l.Z.useForm(),t=(0,h.s0)(),{editId:i}=(0,f.v9)((e=>e.editData)),I=(0,f.I0)(),[y,F]=(0,a.useState)([]),[w,S]=(0,a.useState)([]),[C,D]=(0,a.useState)([]),[V,M]=(0,a.useState)(""),[L,P]=(0,a.useState)(""),[E,z]=(0,a.useState)(""),[k,q]=(0,a.useState)(""),[U,O]=(0,a.useState)(0),{data:Q,refetch:T}=(0,p.useQuery)("get-model",(()=>v.Z.getData("/product")),{enabled:!1}),{data:_,refetch:B}=(0,p.useQuery)("get-position",(()=>v.Z.getData("/position?model=".concat(V))),{enabled:!1}),{data:R,refetch:J}=(0,p.useQuery)("get-exterior",(()=>v.Z.getData("/exterior?model=".concat(V,"&position=").concat(L))),{enabled:!1}),{data:N,refetch:G}=(0,p.useQuery)("get-interior",(()=>v.Z.getData("/interior?model=".concat(V,"&position=").concat(L,"&exterior=").concat(E))),{enabled:!1}),{mutate:A,data:H,isLoading:K,isSuccess:W}=(0,p.useMutation)((e=>{let{url:t,formData:i}=e;return v.Z.postData(t,i)}),{onError:e=>n.ZP.error(e.message,"Rasmning JPG,JPEG,PNG formatlariga ruxsat etilgan")}),{mutate:X,data:Y,isLoading:$,isSuccess:ee}=(0,p.useMutation)((e=>{let{url:t,data:i}=e;return v.Z.postData(t,i)}),{onSuccess:()=>{n.ZP.success("Success")},onError:e=>{n.ZP.error(e.message)}}),{isLoading:te,data:ie,refetch:ae,isSuccess:le}=(0,p.useQuery)(["edit-option",i],(()=>v.Z.getDataByID("/option",i)),{enabled:!1}),{mutate:ne,isLoading:oe,data:se,isSuccess:de}=(0,p.useMutation)((e=>{let{url:t,data:i,id:a}=e;return v.Z.editData(t,i,a)}),{onSuccess:()=>{n.ZP.success("Success")},onError:e=>{n.ZP.error(e)}}),{mutate:re}=(0,p.useMutation)((e=>{let{url:t,ids:i}=e;return v.Z.deleteImages(t,i)}),{onSuccess:()=>n.ZP.success("Success"),onError:e=>n.ZP.error(e.message)});(0,a.useEffect)((()=>{V&&B();const t=e.getFieldsValue();(null===ie||void 0===ie?void 0:ie.model)!==(null===t||void 0===t?void 0:t.model)&&(e.setFieldsValue({position:""}),e.setFieldsValue({exterior:""}),e.setFieldsValue({interior:""}))}),[V]),(0,a.useEffect)((()=>{L&&J();const t=e.getFieldsValue();(null===ie||void 0===ie?void 0:ie.position)!==(null===t||void 0===t?void 0:t.position)&&(e.setFieldsValue({exterior:""}),e.setFieldsValue({interior:""}))}),[L]),(0,a.useEffect)((()=>{E&&G();const t=e.getFieldsValue();(null===ie||void 0===ie?void 0:ie.exterior)!==(null===t||void 0===t?void 0:t.exterior)&&e.setFieldsValue({interior:""})}),[E]),(0,a.useEffect)((()=>{de&&I({type:x.Pb,payload:""}),(ee||de)&&t("/option")}),[Y,se]),(0,a.useEffect)((()=>{""!==i&&ae()}),[i]),(0,a.useEffect)((()=>{""===i&&e.setFieldsValue(j),T()}),[]),(0,a.useEffect)((()=>{var t,i,a,l,n,o;const s=[],d=[];if(void 0!==ie)for(let e=0;e<ie.includes.length;e++){var r,u;let t=[];var c,m,p,v,g,h;if("null"!==(null===(r=ie.includes[e])||void 0===r||null===(u=r.image)||void 0===u?void 0:u.name))t=[{uid:null===(c=ie.includes[e])||void 0===c||null===(m=c.image)||void 0===m?void 0:m._id,name:null===(p=ie.includes[e])||void 0===p||null===(v=p.image)||void 0===v?void 0:v.name,status:"done",url:"".concat("https://leapmotorca.uz/api","/").concat(null===(g=ie.includes[e])||void 0===g||null===(h=g.image)||void 0===h?void 0:h.path)}];const i=ie.includes[e].tags.join(","),a={title:ie.includes[e].title,comment:ie.includes[e].comment,tags:i,mediaId:t};s.push(a),d.push(t)}const f=[{uid:null===ie||void 0===ie||null===(t=ie.bannerImage)||void 0===t?void 0:t._id,name:null===ie||void 0===ie||null===(i=ie.bannerImage)||void 0===i?void 0:i.name,status:"done",url:"".concat("https://leapmotorca.uz/api","/").concat(null===ie||void 0===ie||null===(a=ie.bannerImage)||void 0===a?void 0:a.path)}],x=[{uid:null===ie||void 0===ie||null===(l=ie.mainImage)||void 0===l?void 0:l._id,name:null===ie||void 0===ie||null===(n=ie.mainImage)||void 0===n?void 0:n.name,status:"done",url:"".concat("https://leapmotorca.uz/api","/").concat(null===ie||void 0===ie||null===(o=ie.mainImage)||void 0===o?void 0:o.path)}];if(le){const t={model:ie.model,position:ie.position,exterior:ie.exterior,interior:ie.interior,name:ie.name,bonus:"",includeComment:ie.includeComment,price:0===ie.price?null:ie.price,mainMediaId:x,bannerMediaId:f,includes:s};M(ie.model),P(ie.position),z(ie.exterior),S(f),F(x),D(d),e.setFieldsValue(t)}}),[ie]);(0,a.useEffect)((()=>{const t=JSON.parse(localStorage.getItem("myFormValues"));t&&(t.images=[],e.setFieldsValue(t));const i=()=>{localStorage.setItem("myFormValues",JSON.stringify(e.getFieldsValue()))};return window.addEventListener("beforeunload",i),()=>{localStorage.removeItem("editDataId"),localStorage.removeItem("myFormValues"),window.removeEventListener("beforeunload",i)}}),[]);const ue=(0,a.useMemo)((()=>null===Q||void 0===Q?void 0:Q.map((e=>({value:null===e||void 0===e?void 0:e.model,label:null===e||void 0===e?void 0:e.model})))),[Q]),ce=(0,a.useMemo)((()=>null===_||void 0===_?void 0:_.map((e=>({value:null===e||void 0===e?void 0:e.name,label:null===e||void 0===e?void 0:e.name})))),[_]),me=(0,a.useMemo)((()=>null===R||void 0===R?void 0:R.map((e=>({value:null===e||void 0===e?void 0:e.name,label:null===e||void 0===e?void 0:e.name})))),[R]),pe=(0,a.useMemo)((()=>null===N||void 0===N?void 0:N.map((e=>({value:null===e||void 0===e?void 0:e.name,label:null===e||void 0===e?void 0:e.name})))),[N]);(0,a.useEffect)((()=>{if(W&&"main"===k){var t,i,a;const e=[{uid:null===(t=H[0])||void 0===t?void 0:t._id,name:null===(i=H[0])||void 0===i?void 0:i.name,status:"done",url:"".concat("https://leapmotorca.uz/api","/").concat(null===(a=H[0])||void 0===a?void 0:a.path)}];F(e),q("")}if(W&&"banner"===k){var l,n,o;const e=[{uid:null===(l=H[0])||void 0===l?void 0:l._id,name:null===(n=H[0])||void 0===n?void 0:n.name,status:"done",url:"".concat("https://leapmotorca.uz/api","/").concat(null===(o=H[0])||void 0===o?void 0:o.path)}];S(e),q("")}const s=[...C];if(W&&"includes"===k){var d,r,u;const t=[{uid:null===(d=H[0])||void 0===d?void 0:d._id,name:null===(r=H[0])||void 0===r?void 0:r.name,status:"done",url:"".concat("https://leapmotorca.uz/api","/").concat(null===(u=H[0])||void 0===u?void 0:u.path)}];s[U]=t,D(s);const i=e.getFieldsValue(),a=null===i||void 0===i?void 0:i.includes;a[U]||(a[U]={mediaId:"",tags:"",title:"",comment:""}),a[U].mediaId=t,e.setFieldsValue({items:a}),q("")}}),[H]);const ve=async e=>{let t=e.url;t||(t=await new Promise((t=>{const i=new FileReader;i.readAsDataURL(e.originFileObj),i.onload=()=>t(i.result)})));const i=new Image;i.src=t;const a=window.open(t);null===a||void 0===a||a.document.write(i.outerHTML)};return(0,Z.jsx)("div",{children:$||te||oe||K?(0,Z.jsx)(g.QP,{}):(0,Z.jsxs)(l.Z,{form:e,name:"basic",labelCol:{span:24},wrapperCol:{span:24},style:{maxWidth:"100%"},initialValues:j,onFinish:e=>{var t,a;const l=[];for(let i=0;i<e.includes.length;i++){let t,a="";var n,o;if(C.length>0)if(null===C[i]||(null===(n=C[i])||void 0===n?void 0:n.length)<1)a="";else a=null===(o=C[i][0])||void 0===o?void 0:o.uid;e.includes[i].tags&&(t=e.includes[i].tags.split(","));const s={title:e.includes[i].title||"",comment:e.includes[i].comment||"",tags:t||[],mediaId:a};l.push(s)}const s={model:e.model,position:e.position,exterior:e.exterior,interior:e.interior,name:e.name,bonus:"",includeComment:e.includeComment,price:null===e.price||""===e.price?0:e.price,bannerMediaId:null===(t=w[0])||void 0===t?void 0:t.uid,mainMediaId:null===(a=y[0])||void 0===a?void 0:a.uid,includes:l};le?ne({url:"/option",data:s,id:i}):X({url:"/option",data:s})},onFinishFailed:e=>{console.log("Failed:",e)},autoComplete:"off",children:[(0,Z.jsxs)(o.Z,{gutter:20,children:[(0,Z.jsx)(s.Z,{span:12,children:(0,Z.jsx)(l.Z.Item,{label:"\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u043c\u043e\u0434\u0435\u043b\u044c",name:"model",rules:[{required:!0,message:"\u041f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430, \u0432\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0441\u0432\u043e\u044e \u043c\u043e\u0434\u0435\u043b\u044c"}],children:(0,Z.jsx)(d.default,{style:{width:"100%"},onChange:e=>{M(e)},placeholder:"\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u043e\u0434\u043d\u0443 \u043c\u043e\u0434\u0435\u043b\u044c",optionLabelProp:"label",options:ue})})}),(0,Z.jsx)(s.Z,{span:12,children:(0,Z.jsx)(l.Z.Item,{label:"\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u043f\u043e\u0437\u0438\u0446\u0438\u044f",name:"position",rules:[{required:!0,message:"\u041f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430, \u0432\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0441\u0432\u043e\u044e \u043f\u043e\u0437\u0438\u0446\u0438\u044f"}],children:(0,Z.jsx)(d.default,{style:{width:"100%"},onChange:e=>{P(e)},placeholder:"\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u043e\u0434\u043d\u0443 \u043f\u043e\u0437\u0438\u0446\u0438\u044f",optionLabelProp:"label",options:ce})})})]}),(0,Z.jsxs)(o.Z,{gutter:20,children:[(0,Z.jsx)(s.Z,{span:12,children:(0,Z.jsx)(l.Z.Item,{label:"\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u042d\u043a\u0441\u0442\u0435\u0440\u044c\u0435\u0440",name:"exterior",rules:[{required:!0,message:"\u041f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430, \u0432\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0441\u0432\u043e\u0439 \u044d\u043a\u0441\u0442\u0435\u0440\u044c\u0435\u0440"}],children:(0,Z.jsx)(d.default,{style:{width:"100%"},placeholder:"\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u043e\u0434\u043d\u0443 \u044d\u043a\u0441\u0442\u0435\u0440\u044c\u0435\u0440",optionLabelProp:"label",onChange:e=>{z(e)},options:me})})}),(0,Z.jsx)(s.Z,{span:12,children:(0,Z.jsx)(l.Z.Item,{label:"\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0418\u043d\u0442\u0435\u0440\u044c\u0435\u0440",name:"interior",rules:[{required:!0,message:"\u041f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430, \u0432\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0441\u0432\u043e\u0439 \u0418\u043d\u0442\u0435\u0440\u044c\u0435\u0440"}],children:(0,Z.jsx)(d.default,{style:{width:"100%"},placeholder:"\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u043e\u0434\u043d\u0443 \u0418\u043d\u0442\u0435\u0440\u044c\u0435\u0440",optionLabelProp:"label",options:pe})})}),(0,Z.jsx)(s.Z,{span:12,children:(0,Z.jsx)(l.Z.Item,{label:"\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0412\u0430\u0440\u0438\u0430\u043d\u0442",name:"name",rules:[{required:!0,message:"\u041f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430, \u0432\u0432\u0435\u0434\u0438\u0442\u0435 \u0412\u0430\u0440\u0438\u0430\u043d\u0442"}],children:(0,Z.jsx)(r.default,{})})}),(0,Z.jsx)(s.Z,{span:12,children:(0,Z.jsx)(l.Z.Item,{label:"\u0426\u0435\u043d\u0430, (\u043d\u0435 \u0442\u0440\u0435\u0431\u0443\u0435\u0442\u0441\u044f)",name:"price",children:(0,Z.jsx)(u.Z,{style:{width:"100%"}})})})]}),(0,Z.jsx)(o.Z,{gutter:20,children:(0,Z.jsx)(s.Z,{span:24,children:(0,Z.jsx)(l.Z.Item,{label:"\u0412\u043a\u043b\u044e\u0447\u0438\u0442\u044c \u043a\u043e\u043c\u043c\u0435\u043d\u0442\u0430\u0440\u0438\u0439, (\u043d\u0435 \u0442\u0440\u0435\u0431\u0443\u0435\u0442\u0441\u044f)",name:"includeComment",children:(0,Z.jsx)(r.default,{})})})}),(0,Z.jsxs)(o.Z,{gutter:20,children:[(0,Z.jsx)(s.Z,{span:12,children:(0,Z.jsx)(l.Z.Item,{label:"\u0418\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435 \u0431\u0430\u043d\u043d\u0435\u0440",name:"bannerMediaId",rules:[{required:!0,message:"\u0422\u0440\u0435\u0431\u0443\u0435\u0442\u0441\u044f \u0437\u0430\u0433\u0440\u0443\u0437\u043a\u0430 \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u044f \u0431\u0430\u043d\u043d\u0435\u0440"}],children:(0,Z.jsx)(c.Z,{maxCount:1,fileList:w,listType:"picture-card",onChange:t=>{let{fileList:i}=t;if(e.setFieldsValue({bannerMediaId:i}),0!==w.length||0===i.length){var a;let e=[null===(a=w[0])||void 0===a?void 0:a.uid];re({url:"/medias",ids:{ids:e}}),S([])}const l=new FormData;0!==i.length&&(l.append("media",i[0].originFileObj),A({url:"/medias",formData:l}),q("banner"))},onPreview:ve,beforeUpload:()=>!1,children:w.length>0?"":"Upload"})})}),(0,Z.jsx)(s.Z,{span:12,children:(0,Z.jsx)(l.Z.Item,{label:"\u0418\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435 \u043e\u0441\u043d\u043e\u0432\u043d\u043e\u0439",name:"mainMediaId",rules:[{required:!0,message:"\u0422\u0440\u0435\u0431\u0443\u0435\u0442\u0441\u044f \u0437\u0430\u0433\u0440\u0443\u0437\u043a\u0430 \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u044f \u043e\u0441\u043d\u043e\u0432\u043d\u043e\u0439"}],children:(0,Z.jsx)(c.Z,{maxCount:1,fileList:y,listType:"picture-card",onChange:t=>{let{fileList:i}=t;if(e.setFieldsValue({mainMediaId:i}),0!==y.length||0===i.length){var a;const e=[null===(a=y[0])||void 0===a?void 0:a.uid];re({url:"/medias",ids:{ids:e}}),F([])}const l=new FormData;0!==i.length&&(l.append("media",i[0].originFileObj),A({url:"/medias",formData:l}),q("main"))},onPreview:ve,beforeUpload:()=>!1,children:y.length>0?"":"Upload"})})})]}),(0,Z.jsx)(l.Z.List,{name:"includes",children:(t,i)=>{let{add:a,remove:n}=i;return(0,Z.jsxs)(Z.Fragment,{children:[t.map(((e,t)=>{const i=C[t]||[];return(0,Z.jsxs)("div",{style:{marginBottom:20},children:[(0,Z.jsxs)(o.Z,{gutter:20,children:[(0,Z.jsx)(s.Z,{span:12,children:(0,Z.jsx)(l.Z.Item,{label:"\u0417\u0430\u0433\u043e\u043b\u043e\u0432\u043e\u043a, (\u043d\u0435 \u0442\u0440\u0435\u0431\u0443\u0435\u0442\u0441\u044f)",name:[e.name,"title"],children:(0,Z.jsx)(r.default,{})})}),(0,Z.jsx)(s.Z,{span:12,children:(0,Z.jsx)(l.Z.Item,{label:"\u041a\u043e\u043c\u043c\u0435\u043d\u0442\u0430\u0440\u0438\u0439, (\u043d\u0435 \u0442\u0440\u0435\u0431\u0443\u0435\u0442\u0441\u044f)",name:[e.name,"comment"],children:(0,Z.jsx)(r.default,{})})}),(0,Z.jsx)(s.Z,{span:24,children:(0,Z.jsx)(l.Z.Item,{label:"\u041a\u0430\u043a\u043e\u0432\u044b \u043f\u0440\u0435\u0438\u043c\u0443\u0449\u0435\u0441\u0442\u0432\u0430 \u044d\u0442\u043e\u0439 \u0432\u043a\u043b\u044e\u0447\u0430\u0435\u0442, (\u043d\u0435 \u0442\u0440\u0435\u0431\u0443\u0435\u0442\u0441\u044f)",name:[e.name,"tags"],children:(0,Z.jsx)(r.default,{placeholder:"option1, option2, option3"})})})]}),(0,Z.jsx)(l.Z.Item,{label:"\u0424\u043e\u0442\u043e, (\u043d\u0435 \u0442\u0440\u0435\u0431\u0443\u0435\u0442\u0441\u044f) ".concat(t+1),name:[e.name,"mediaId"],children:(0,Z.jsx)(c.Z,{maxCount:1,listType:"picture-card",fileList:i,onChange:e=>((e,t)=>{let{fileList:i}=t;if(O(e),C[e]||0===i.length){const t=[C[e][0].uid];re({url:"/medias",ids:{ids:t}}),C[e]=null,D(C)}const a=new FormData;0!==i.length&&(a.append("media",i[0].originFileObj),A({url:"/medias",formData:a}),q("includes"))})(t,e),onPreview:ve,beforeUpload:()=>!1,children:i.length<1&&"+ Upload"})}),(0,Z.jsx)(b.Z,{onClick:()=>((e,t,i,a)=>{if(console.log(i),console.log(a),console.log(C),a===C[i]&&C.length>0){var l;const e=[null===(l=C[i][0])||void 0===l?void 0:l.uid];C.splice(i,1),re({url:"/medias",ids:{ids:e}})}t(e)})(e.name,n,t,i)})]},e.fieldKey)})),(0,Z.jsx)(l.Z.Item,{children:(0,Z.jsx)(m.Z,{type:"primary",onClick:()=>(t=>{let i=[];t();const a=e.getFieldsValue();null!==a&&void 0!==a&&a.includes[0]||i.push({mediaId:"",title:"",comment:"",tags:""}),e.setFieldsValue({items:i})})(a),block:!0,style:{backgroundColor:"#28a745"},children:"\u0414\u043e\u0431\u0430\u0432\u044c\u0442\u0435 \u043f\u0440\u0435\u0434\u043c\u0435\u0442"})})]})}}),(0,Z.jsx)(m.Z,{type:"primary",htmlType:"submit",style:{width:"100%",marginTop:"20px"},children:le?"Edit":"Add"})]})})}},68747:(e,t,i)=>{i.d(t,{Z:()=>d});var a=i(1413),l=i(72791);const n={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M696 480H328c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h368c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8z"}},{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}}]},name:"minus-circle",theme:"outlined"};var o=i(54291),s=function(e,t){return l.createElement(o.Z,(0,a.Z)((0,a.Z)({},e),{},{ref:t,icon:n}))};s.displayName="MinusCircleOutlined";const d=l.forwardRef(s)}}]);
//# sourceMappingURL=963.2fb64da9.chunk.js.map