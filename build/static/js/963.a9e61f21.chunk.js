"use strict";(self.webpackChunkcrema=self.webpackChunkcrema||[]).push([[963],{68438:(e,t,i)=>{i.d(t,{Z:()=>o});var a=i(74569),l=i.n(a);l().defaults.baseURL="".concat("https://leapmotorca.uz/api"),l().interceptors.request.use((e=>{const t=(e=>{try{return localStorage.getItem(e)}catch(t){console.log("Error getting data")}})("lptoken"),i=null!==t?"Bearer ".concat(t):"";return e.headers.authorization=i,e}));const n=l(),o={async getData(e){const{data:t}=await n.get(e);return t},async getDataByID(e,t){const{data:i}=await n.get("".concat(e,"/").concat(t));return i},async postData(e,t){const{data:i}=await n.post(e,t);return i},async editData(e,t,i){const{data:a}=await n.put("".concat(e,"/").concat(i),t);return a},async deleteData(e,t){await n.delete("".concat(e,"/").concat(t))},async deleteImages(e,t){console.log("delete image",t),await n.delete(e,{data:t})}}},17963:(e,t,i)=>{i.r(t),i.d(t,{default:()=>y});var a=i(72791),l=i(2409),n=i(50419),o=i(66106),s=i(30914),d=i(83734),r=i(49389),u=i(13344),c=i(93086),m=i(87309),p=i(91933),v=i(68438),g=i(98986),h=i(57689),f=i(16030),x=i(77221),Z=i(68117),b=i(68747),j=i(80184);const I={model:"",position:"",exterior:"",interior:"",name:"",price:null,bonus:"",includeComment:"",mainMediaId:"",bannerMediaId:"",includes:[]},y=()=>{const[e]=l.Z.useForm(),t=(0,h.s0)(),{editId:i}=(0,f.v9)((e=>e.editData)),y=(0,f.I0)(),[F,w]=(0,a.useState)([]),[S,C]=(0,a.useState)([]),[D,V]=(0,a.useState)([]),[M,L]=(0,a.useState)(""),[P,E]=(0,a.useState)(""),[z,k]=(0,a.useState)(""),[q,U]=(0,a.useState)(""),[O,Q]=(0,a.useState)(0),{data:T,refetch:_}=(0,p.useQuery)("get-model",(()=>v.Z.getData("/product")),{enabled:!1}),{data:B,refetch:R}=(0,p.useQuery)("get-position",(()=>v.Z.getData("/position?model=".concat(M))),{enabled:!1}),{data:J,refetch:N}=(0,p.useQuery)("get-exterior",(()=>v.Z.getData("/exterior?model=".concat(M,"&position=").concat(P))),{enabled:!1}),{data:G,refetch:A}=(0,p.useQuery)("get-interior",(()=>v.Z.getData("/interior?model=".concat(M,"&position=").concat(P,"&exterior=").concat(z))),{enabled:!1}),{mutate:H,data:K,isLoading:W,isSuccess:X}=(0,p.useMutation)((e=>{let{url:t,formData:i}=e;return v.Z.postData(t,i)}),{onError:e=>n.ZP.error(e.message,"Rasmning JPG,JPEG,PNG formatlariga ruxsat etilgan")}),{mutate:Y,data:$,isLoading:ee,isSuccess:te}=(0,p.useMutation)((e=>{let{url:t,data:i}=e;return v.Z.postData(t,i)}),{onSuccess:()=>{n.ZP.success("Success")},onError:e=>{n.ZP.error(e.message)}}),{isLoading:ie,data:ae,refetch:le,isSuccess:ne}=(0,p.useQuery)(["edit-option",i],(()=>v.Z.getDataByID("/option",i)),{enabled:!1}),{mutate:oe,isLoading:se,data:de,isSuccess:re}=(0,p.useMutation)((e=>{let{url:t,data:i,id:a}=e;return v.Z.editData(t,i,a)}),{onSuccess:()=>{n.ZP.success("Success")},onError:e=>{n.ZP.error(e)}}),{mutate:ue}=(0,p.useMutation)((e=>{let{url:t,ids:i}=e;return v.Z.deleteImages(t,i)}),{onSuccess:()=>n.ZP.success("Success"),onError:e=>n.ZP.error(e.message)});(0,a.useEffect)((()=>{M&&R();const t=e.getFieldsValue();(null===ae||void 0===ae?void 0:ae.model)!==(null===t||void 0===t?void 0:t.model)&&(e.setFieldsValue({position:""}),e.setFieldsValue({exterior:""}),e.setFieldsValue({interior:""}))}),[M]),(0,a.useEffect)((()=>{P&&N();const t=e.getFieldsValue();(null===ae||void 0===ae?void 0:ae.position)!==(null===t||void 0===t?void 0:t.position)&&(e.setFieldsValue({exterior:""}),e.setFieldsValue({interior:""}))}),[P]),(0,a.useEffect)((()=>{z&&A();const t=e.getFieldsValue();(null===ae||void 0===ae?void 0:ae.exterior)!==(null===t||void 0===t?void 0:t.exterior)&&e.setFieldsValue({interior:""})}),[z]),(0,a.useEffect)((()=>{re&&y({type:x.Pb,payload:""}),(te||re)&&t("/option")}),[$,de]),(0,a.useEffect)((()=>{""!==i&&le()}),[i]),(0,a.useEffect)((()=>{""===i&&e.setFieldsValue(I),_()}),[]),(0,a.useEffect)((()=>{var t,i,a,l,n,o;const s=[],d=[];if(void 0!==ae)for(let e=0;e<ae.includes.length;e++){var r,u;let t=[];var c,m,p,v,g,h;if("null"!==(null===(r=ae.includes[e])||void 0===r||null===(u=r.image)||void 0===u?void 0:u.name))t=[{uid:null===(c=ae.includes[e])||void 0===c||null===(m=c.image)||void 0===m?void 0:m._id,name:null===(p=ae.includes[e])||void 0===p||null===(v=p.image)||void 0===v?void 0:v.name,status:"done",url:"".concat("https://leapmotorca.uz/api","/").concat(null===(g=ae.includes[e])||void 0===g||null===(h=g.image)||void 0===h?void 0:h.path)}];const i=ae.includes[e].tags.join(","),a={title:ae.includes[e].title,comment:ae.includes[e].comment,tags:i,mediaId:t};s.push(a),d.push(t)}const f=[{uid:null===ae||void 0===ae||null===(t=ae.bannerImage)||void 0===t?void 0:t._id,name:null===ae||void 0===ae||null===(i=ae.bannerImage)||void 0===i?void 0:i.name,status:"done",url:"".concat("https://leapmotorca.uz/api","/").concat(null===ae||void 0===ae||null===(a=ae.bannerImage)||void 0===a?void 0:a.path)}],x=[{uid:null===ae||void 0===ae||null===(l=ae.mainImage)||void 0===l?void 0:l._id,name:null===ae||void 0===ae||null===(n=ae.mainImage)||void 0===n?void 0:n.name,status:"done",url:"".concat("https://leapmotorca.uz/api","/").concat(null===ae||void 0===ae||null===(o=ae.mainImage)||void 0===o?void 0:o.path)}];if(ne){const t={model:ae.model,position:ae.position,exterior:ae.exterior,interior:ae.interior,name:ae.name,bonus:"",includeComment:ae.includeComment,price:0===ae.price?null:ae.price,mainMediaId:x,bannerMediaId:f,includes:s};L(ae.model),E(ae.position),k(ae.exterior),C(f),w(x),V(d),e.setFieldsValue(t)}}),[ae]);(0,a.useEffect)((()=>{const t=JSON.parse(localStorage.getItem("myFormValues"));t&&(t.images=[],e.setFieldsValue(t));const i=()=>{localStorage.setItem("myFormValues",JSON.stringify(e.getFieldsValue()))};return window.addEventListener("beforeunload",i),()=>{localStorage.removeItem("editDataId"),localStorage.removeItem("myFormValues"),window.removeEventListener("beforeunload",i)}}),[]);const ce=(0,a.useMemo)((()=>null===T||void 0===T?void 0:T.map((e=>({value:null===e||void 0===e?void 0:e.model,label:null===e||void 0===e?void 0:e.model})))),[T]),me=(0,a.useMemo)((()=>null===B||void 0===B?void 0:B.map((e=>({value:null===e||void 0===e?void 0:e.name,label:null===e||void 0===e?void 0:e.name})))),[B]),pe=(0,a.useMemo)((()=>null===J||void 0===J?void 0:J.map((e=>({value:null===e||void 0===e?void 0:e.name,label:null===e||void 0===e?void 0:e.name})))),[J]),ve=(0,a.useMemo)((()=>null===G||void 0===G?void 0:G.map((e=>({value:null===e||void 0===e?void 0:e.name,label:null===e||void 0===e?void 0:e.name})))),[G]);(0,a.useEffect)((()=>{if(X&&"main"===q){var t,i,a;const e=[{uid:null===(t=K[0])||void 0===t?void 0:t._id,name:null===(i=K[0])||void 0===i?void 0:i.name,status:"done",url:"".concat("https://leapmotorca.uz/api","/").concat(null===(a=K[0])||void 0===a?void 0:a.path)}];w(e),U("")}if(X&&"banner"===q){var l,n,o;const e=[{uid:null===(l=K[0])||void 0===l?void 0:l._id,name:null===(n=K[0])||void 0===n?void 0:n.name,status:"done",url:"".concat("https://leapmotorca.uz/api","/").concat(null===(o=K[0])||void 0===o?void 0:o.path)}];C(e),U("")}const s=[...D];if(X&&"includes"===q){var d,r,u;const t=[{uid:null===(d=K[0])||void 0===d?void 0:d._id,name:null===(r=K[0])||void 0===r?void 0:r.name,status:"done",url:"".concat("https://leapmotorca.uz/api","/").concat(null===(u=K[0])||void 0===u?void 0:u.path)}];s[O]=t,V(s);const i=e.getFieldsValue(),a=null===i||void 0===i?void 0:i.includes;a[O]||(a[O]={mediaId:"",tags:"",title:"",comment:""}),a[O].mediaId=t,e.setFieldsValue({items:a}),U("")}}),[K]);const ge=async e=>{let t=e.url;t||(t=await new Promise((t=>{const i=new FileReader;i.readAsDataURL(e.originFileObj),i.onload=()=>t(i.result)})));const i=new Image;i.src=t;const a=window.open(t);null===a||void 0===a||a.document.write(i.outerHTML)};return(0,j.jsx)("div",{children:ee||ie||se||W?(0,j.jsx)(g.QP,{}):(0,j.jsxs)(l.Z,{form:e,name:"basic",labelCol:{span:24},wrapperCol:{span:24},style:{maxWidth:"100%"},initialValues:I,onFinish:e=>{var t,a;const l=[];for(let i=0;i<e.includes.length;i++){let t,a="";var n,o;if(D.length>0)if(null===D[i]||(null===(n=D[i])||void 0===n?void 0:n.length)<1)a="";else a=null===(o=D[i][0])||void 0===o?void 0:o.uid;e.includes[i].tags&&(t=e.includes[i].tags.split(","));const s={title:e.includes[i].title||"",comment:e.includes[i].comment||"",tags:t||[],mediaId:a};l.push(s)}const s={model:e.model,position:e.position,exterior:e.exterior,interior:e.interior,name:e.name,bonus:"",includeComment:e.includeComment,price:null===e.price||""===e.price?0:e.price,bannerMediaId:null===(t=S[0])||void 0===t?void 0:t.uid,mainMediaId:null===(a=F[0])||void 0===a?void 0:a.uid,includes:l};ne?oe({url:"/option",data:s,id:i}):Y({url:"/option",data:s})},onFinishFailed:e=>{console.log("Failed:",e)},autoComplete:"off",children:[(0,j.jsxs)(o.Z,{gutter:20,children:[(0,j.jsx)(s.Z,{span:12,children:(0,j.jsx)(l.Z.Item,{label:"\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u043c\u043e\u0434\u0435\u043b\u044c",name:"model",rules:[{required:!0,message:"\u041f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430, \u0432\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0441\u0432\u043e\u044e \u043c\u043e\u0434\u0435\u043b\u044c"}],children:(0,j.jsx)(d.default,{style:{width:"100%"},onChange:e=>{L(e)},placeholder:"\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u043e\u0434\u043d\u0443 \u043c\u043e\u0434\u0435\u043b\u044c",optionLabelProp:"label",options:ce})})}),(0,j.jsx)(s.Z,{span:12,children:(0,j.jsx)(l.Z.Item,{label:"\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u043f\u043e\u0437\u0438\u0446\u0438\u044f",name:"position",rules:[{required:!0,message:"\u041f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430, \u0432\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0441\u0432\u043e\u044e \u043f\u043e\u0437\u0438\u0446\u0438\u044f"}],children:(0,j.jsx)(d.default,{style:{width:"100%"},onChange:e=>{E(e)},placeholder:"\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u043e\u0434\u043d\u0443 \u043f\u043e\u0437\u0438\u0446\u0438\u044f",optionLabelProp:"label",options:me})})})]}),(0,j.jsxs)(o.Z,{gutter:20,children:[(0,j.jsx)(s.Z,{span:12,children:(0,j.jsx)(l.Z.Item,{label:"\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u042d\u043a\u0441\u0442\u0435\u0440\u044c\u0435\u0440",name:"exterior",rules:[{required:!0,message:"\u041f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430, \u0432\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0441\u0432\u043e\u0439 \u044d\u043a\u0441\u0442\u0435\u0440\u044c\u0435\u0440"}],children:(0,j.jsx)(d.default,{style:{width:"100%"},placeholder:"\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u043e\u0434\u043d\u0443 \u044d\u043a\u0441\u0442\u0435\u0440\u044c\u0435\u0440",optionLabelProp:"label",onChange:e=>{k(e)},options:pe})})}),(0,j.jsx)(s.Z,{span:12,children:(0,j.jsx)(l.Z.Item,{label:"\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0418\u043d\u0442\u0435\u0440\u044c\u0435\u0440",name:"interior",rules:[{required:!0,message:"\u041f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430, \u0432\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0441\u0432\u043e\u0439 \u0418\u043d\u0442\u0435\u0440\u044c\u0435\u0440"}],children:(0,j.jsx)(d.default,{style:{width:"100%"},placeholder:"\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u043e\u0434\u043d\u0443 \u0418\u043d\u0442\u0435\u0440\u044c\u0435\u0440",optionLabelProp:"label",options:ve})})}),(0,j.jsx)(s.Z,{span:12,children:(0,j.jsx)(l.Z.Item,{label:"\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0412\u0430\u0440\u0438\u0430\u043d\u0442",name:"name",rules:[{required:!0,message:"\u041f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430, \u0432\u0432\u0435\u0434\u0438\u0442\u0435 \u0412\u0430\u0440\u0438\u0430\u043d\u0442"}],children:(0,j.jsx)(r.default,{})})}),(0,j.jsx)(s.Z,{span:12,children:(0,j.jsx)(l.Z.Item,{label:"\u0426\u0435\u043d\u0430, (\u043d\u0435 \u0442\u0440\u0435\u0431\u0443\u0435\u0442\u0441\u044f)",name:"price",children:(0,j.jsx)(u.Z,{style:{width:"100%"}})})})]}),(0,j.jsx)(o.Z,{gutter:20,children:(0,j.jsx)(s.Z,{span:24,children:(0,j.jsx)(l.Z.Item,{label:"\u0412\u043a\u043b\u044e\u0447\u0438\u0442\u044c \u043a\u043e\u043c\u043c\u0435\u043d\u0442\u0430\u0440\u0438\u0439, (\u043d\u0435 \u0442\u0440\u0435\u0431\u0443\u0435\u0442\u0441\u044f)",name:"includeComment",children:(0,j.jsx)(r.default,{})})})}),(0,j.jsxs)(o.Z,{gutter:20,children:[(0,j.jsx)(s.Z,{span:12,children:(0,j.jsx)(l.Z.Item,{label:"\u0418\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435 \u0431\u0430\u043d\u043d\u0435\u0440",name:"bannerMediaId",rules:[{required:!0,message:"\u0422\u0440\u0435\u0431\u0443\u0435\u0442\u0441\u044f \u0437\u0430\u0433\u0440\u0443\u0437\u043a\u0430 \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u044f \u0431\u0430\u043d\u043d\u0435\u0440"}],children:(0,j.jsx)(Z.Z,{children:(0,j.jsx)(c.Z,{maxCount:1,fileList:S,listType:"picture-card",onChange:t=>{let{fileList:i}=t;if(e.setFieldsValue({bannerMediaId:i}),0!==S.length||0===i.length){var a;let e=[null===(a=S[0])||void 0===a?void 0:a.uid];ue({url:"/medias",ids:{ids:e}}),C([])}const l=new FormData;0!==i.length&&(l.append("media",i[0].originFileObj),H({url:"/medias",formData:l}),U("banner"))},onPreview:ge,beforeUpload:()=>!1,children:S.length>0?"":"Upload"})})})}),(0,j.jsx)(s.Z,{span:12,children:(0,j.jsx)(l.Z.Item,{label:"\u0418\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435 \u043e\u0441\u043d\u043e\u0432\u043d\u043e\u0439",name:"mainMediaId",rules:[{required:!0,message:"\u0422\u0440\u0435\u0431\u0443\u0435\u0442\u0441\u044f \u0437\u0430\u0433\u0440\u0443\u0437\u043a\u0430 \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u044f \u043e\u0441\u043d\u043e\u0432\u043d\u043e\u0439"}],children:(0,j.jsx)(Z.Z,{children:(0,j.jsx)(c.Z,{maxCount:1,fileList:F,listType:"picture-card",onChange:t=>{let{fileList:i}=t;if(e.setFieldsValue({mainMediaId:i}),0!==F.length||0===i.length){var a;const e=[null===(a=F[0])||void 0===a?void 0:a.uid];ue({url:"/medias",ids:{ids:e}}),w([])}const l=new FormData;0!==i.length&&(l.append("media",i[0].originFileObj),H({url:"/medias",formData:l}),U("main"))},onPreview:ge,beforeUpload:()=>!1,children:F.length>0?"":"Upload"})})})})]}),(0,j.jsx)(l.Z.List,{name:"includes",children:(t,i)=>{let{add:a,remove:n}=i;return(0,j.jsxs)(j.Fragment,{children:[t.map(((e,t)=>{const i=D[t]||[];return(0,j.jsxs)("div",{style:{marginBottom:20},children:[(0,j.jsxs)(o.Z,{gutter:20,children:[(0,j.jsx)(s.Z,{span:12,children:(0,j.jsx)(l.Z.Item,{label:"\u0417\u0430\u0433\u043e\u043b\u043e\u0432\u043e\u043a, (\u043d\u0435 \u0442\u0440\u0435\u0431\u0443\u0435\u0442\u0441\u044f)",name:[e.name,"title"],children:(0,j.jsx)(r.default,{})})}),(0,j.jsx)(s.Z,{span:12,children:(0,j.jsx)(l.Z.Item,{label:"\u041a\u043e\u043c\u043c\u0435\u043d\u0442\u0430\u0440\u0438\u0439, (\u043d\u0435 \u0442\u0440\u0435\u0431\u0443\u0435\u0442\u0441\u044f)",name:[e.name,"comment"],children:(0,j.jsx)(r.default,{})})}),(0,j.jsx)(s.Z,{span:24,children:(0,j.jsx)(l.Z.Item,{label:"\u041a\u0430\u043a\u043e\u0432\u044b \u043f\u0440\u0435\u0438\u043c\u0443\u0449\u0435\u0441\u0442\u0432\u0430 \u044d\u0442\u043e\u0439 \u0432\u043a\u043b\u044e\u0447\u0430\u0435\u0442, (\u043d\u0435 \u0442\u0440\u0435\u0431\u0443\u0435\u0442\u0441\u044f)",name:[e.name,"tags"],children:(0,j.jsx)(r.default,{placeholder:"option1, option2, option3"})})})]}),(0,j.jsx)(l.Z.Item,{label:"\u0424\u043e\u0442\u043e, (\u043d\u0435 \u0442\u0440\u0435\u0431\u0443\u0435\u0442\u0441\u044f) ".concat(t+1),name:[e.name,"mediaId"],children:(0,j.jsx)(Z.Z,{rotate:!0,children:(0,j.jsx)(c.Z,{maxCount:1,listType:"picture-card",fileList:i,onChange:e=>((e,t)=>{let{fileList:i}=t;if(Q(e),D[e]||0===i.length){const t=[D[e][0].uid];ue({url:"/medias",ids:{ids:t}}),D[e]=null,V(D)}const a=new FormData;0!==i.length&&(a.append("media",i[0].originFileObj),H({url:"/medias",formData:a}),U("includes"))})(t,e),onPreview:ge,beforeUpload:()=>!1,children:i.length<1&&"+ Upload"})})}),(0,j.jsx)(b.Z,{onClick:()=>((e,t,i,a)=>{if(console.log(i),console.log(a),console.log(D),a===D[i]&&D.length>0){var l;const e=[null===(l=D[i][0])||void 0===l?void 0:l.uid];D.splice(i,1),ue({url:"/medias",ids:{ids:e}})}t(e)})(e.name,n,t,i)})]},e.fieldKey)})),(0,j.jsx)(l.Z.Item,{children:(0,j.jsx)(m.Z,{type:"primary",onClick:()=>(t=>{let i=[];t();const a=e.getFieldsValue();null!==a&&void 0!==a&&a.includes[0]||i.push({mediaId:"",title:"",comment:"",tags:""}),e.setFieldsValue({items:i})})(a),block:!0,style:{backgroundColor:"#28a745"},children:"\u0414\u043e\u0431\u0430\u0432\u044c\u0442\u0435 \u043f\u0440\u0435\u0434\u043c\u0435\u0442"})})]})}}),(0,j.jsx)(m.Z,{type:"primary",htmlType:"submit",style:{width:"100%",marginTop:"20px"},children:ne?"Edit":"Add"})]})})}},68747:(e,t,i)=>{i.d(t,{Z:()=>d});var a=i(1413),l=i(72791);const n={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M696 480H328c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h368c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8z"}},{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}}]},name:"minus-circle",theme:"outlined"};var o=i(54291),s=function(e,t){return l.createElement(o.Z,(0,a.Z)((0,a.Z)({},e),{},{ref:t,icon:n}))};s.displayName="MinusCircleOutlined";const d=l.forwardRef(s)}}]);
//# sourceMappingURL=963.a9e61f21.chunk.js.map