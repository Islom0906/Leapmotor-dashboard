"use strict";(self.webpackChunkcrema=self.webpackChunkcrema||[]).push([[312],{68438:function(e,n,t){t.d(n,{Z:function(){return s}});var r=t(74165),a=t(15861),o=t(74569),i=t.n(o);i().defaults.baseURL="".concat("https://leapmotorca.uz/api"),i().interceptors.request.use((function(e){var n=function(e){try{return localStorage.getItem(e)}catch(n){console.log("Error getting data")}}("lptoken"),t=null!==n?"Bearer ".concat(n):"";return e.headers.authorization=t,e}));var u=i(),s={getData:function(e){return(0,a.Z)((0,r.Z)().mark((function n(){var t,a;return(0,r.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,u.get(e);case 2:return t=n.sent,a=t.data,n.abrupt("return",a);case 5:case"end":return n.stop()}}),n)})))()},getDataByID:function(e,n){return(0,a.Z)((0,r.Z)().mark((function t(){var a,o;return(0,r.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,u.get("".concat(e,"/").concat(n));case 2:return a=t.sent,o=a.data,t.abrupt("return",o);case 5:case"end":return t.stop()}}),t)})))()},postData:function(e,n){return(0,a.Z)((0,r.Z)().mark((function t(){var a,o;return(0,r.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,u.post(e,n);case 2:return a=t.sent,o=a.data,t.abrupt("return",o);case 5:case"end":return t.stop()}}),t)})))()},editData:function(e,n,t){return(0,a.Z)((0,r.Z)().mark((function a(){var o,i;return(0,r.Z)().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,u.put("".concat(e,"/").concat(t),n);case 2:return o=r.sent,i=o.data,r.abrupt("return",i);case 5:case"end":return r.stop()}}),a)})))()},deleteData:function(e,n){return(0,a.Z)((0,r.Z)().mark((function t(){return(0,r.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,u.delete("".concat(e,"/").concat(n));case 2:case"end":return t.stop()}}),t)})))()},deleteImages:function(e,n){return(0,a.Z)((0,r.Z)().mark((function t(){return(0,r.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return console.log("delete image",n),t.next=3,u.delete(e,{ids:["64f0ffa5883c58f0433c44d9"]});case 3:case"end":return t.stop()}}),t)})))()}}},87884:function(e,n,t){t.r(n);var r=t(74165),a=t(15861),o=t(93433),i=t(29439),u=t(72791),s=t(2409),c=t(50419),l=t(66106),d=t(30914),f=t(93086),m=t(87309),v=t(22645),p=t(91933),g=t(68438),Z=t(98986),h=t(57689),w=t(16030),x=t(77221),I=t(80184),b={mediaId:[""]};n.default=function(){var e=s.Z.useForm(),n=(0,i.Z)(e,1)[0],t=(0,h.s0)(),S=(0,w.v9)((function(e){return e.editData})).editId,F=(0,w.I0)(),E=(0,u.useState)([]),y=(0,i.Z)(E,2),D=y[0],P=y[1],j=(0,u.useState)([]),k=(0,i.Z)(j,2),L=k[0],V=k[1],C=(0,u.useState)({}),O=(0,i.Z)(C,2),M=O[0],R=O[1],J=(0,u.useState)(!1),U=(0,i.Z)(J,2),z=U[0],B=U[1],G=(0,u.useState)({}),N=(0,i.Z)(G,2),T=N[0],_=N[1];console.log(T);var q=(0,p.useMutation)((function(e){var n=e.url,t=e.data;return g.Z.postData(n,t)}),{onSuccess:function(){return c.ZP.success("Success")},onError:function(e){return c.ZP.error(e.message)}}),A=q.mutate,Q=q.data,H=q.isLoading,W=q.isSuccess,K=q.error,X=q.isError,Y=(0,p.useMutation)((function(e){var n=e.url,t=e.formData;return g.Z.postData(n,t)}),{onError:function(e){return c.ZP.error(e.message,"Rasmning JPG,JPEG,PNG formatlariga ruxsat etilgan")}}),$=Y.mutate,ee=Y.data,ne=Y.isLoading,te=Y.isSuccess,re=(0,p.useQuery)(["edit-filialInner",S],(function(){return g.Z.getDataByID("/filialInner",S)}),{enabled:!1}),ae=re.isLoading,oe=re.data,ie=re.refetch,ue=re.isSuccess,se=(0,p.useMutation)((function(e){var n=e.url,t=e.data,r=e.id;return g.Z.editData(n,t,r)}),{onError:function(e){return c.ZP.error(e.message)}}),ce=se.mutate,le=se.isLoading,de=se.data,fe=se.isSuccess,me=se.error,ve=se.isError,pe=(0,p.useMutation)((function(e){var n=e.url,t=e.ids;return g.Z.deleteImages(n,t)}),{onSuccess:function(){return c.ZP.success("Success")},onError:function(e){return c.ZP.error(e.message)}}).mutate;(0,u.useEffect)((function(){var e=[];(fe&&F({type:x.Pb,payload:""}),ue&&e.length>0)&&pe({url:"/medias",ids:{ids:e}});(W||fe)&&t("/filialInner")}),[Q,de]),(0,u.useEffect)((function(){X&&c.ZP.error(K.message),ve&&c.ZP.error(me.message)}),[K,me]),(0,u.useEffect)((function(){""!==S&&ie()}),[S]),(0,u.useEffect)((function(){""===S&&n.setFieldsValue(b)}),[]),(0,u.useEffect)((function(){for(var e=[],t=0;t<(null===oe||void 0===oe||null===(r=oe.images)||void 0===r?void 0:r.length);t++){var r,a,o,i,u,s={uid:null===oe||void 0===oe||null===(a=oe.images[t])||void 0===a?void 0:a._id,name:null===oe||void 0===oe||null===(o=oe.images[t])||void 0===o?void 0:o.name,location:null===oe||void 0===oe||null===(i=oe.images[t])||void 0===i?void 0:i.path,status:"done",url:"".concat("https://leapmotorca.uz/api","/").concat(null===oe||void 0===oe||null===(u=oe.images[t])||void 0===u?void 0:u.path)};e.push(s)}if(console.log(oe),ue){var c={mediaId:e};P(e),n.setFieldsValue(c)}}),[oe]),(0,u.useEffect)((function(){var e=[],n=[];n=te?L.concat(ee):(0,o.Z)(L);var t=[];n.map((function(e){var n;null!==e&&void 0!==e&&null!==(n=e.originFileObj)&&void 0!==n&&n.uid||t.push(e)})),!ue&&ee?null===ee||void 0===ee||ee.map((function(n){e.push(null===n||void 0===n?void 0:n._id)})):t.map((function(n){null!==n&&void 0!==n&&n.uid?e.push(null===n||void 0===n?void 0:n.uid):e.push(null===n||void 0===n?void 0:n._id)})),console.log(n),console.log(e);var r={mediaId:e};console.log(r),te&&!ue?A({url:"/filialInner",data:r}):(z||te)&&ce({url:"/filialInner",data:r,id:S})}),[ee,M]);(0,u.useEffect)((function(){var e=JSON.parse(localStorage.getItem("myFormValues"));e&&(e.images=[],n.setFieldsValue(e));var t=function(){localStorage.setItem("myFormValues",JSON.stringify(n.getFieldsValue()))};return window.addEventListener("beforeunload",t),function(){localStorage.removeItem("editDataId"),localStorage.removeItem("myFormValues"),window.removeEventListener("beforeunload",t)}}),[]);var ge=function(){var e=(0,a.Z)((0,r.Z)().mark((function e(n){var t,a,o;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=n.url){e.next=5;break}return e.next=4,new Promise((function(e){var t=new FileReader;t.readAsDataURL(n.originFileObj),t.onload=function(){return e(t.result)}}));case 4:t=e.sent;case 5:(a=new Image).src=t,null===(o=window.open(t))||void 0===o||o.document.write(a.outerHTML);case 9:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}();return(0,I.jsx)("div",{children:ne||H||ae||le?(0,I.jsx)(Z.QP,{}):(0,I.jsxs)(s.Z,{form:n,name:"basic",labelCol:{span:24},wrapperCol:{span:24},style:{maxWidth:"100%"},initialValues:b,onFinish:function(e){var n=new FormData,t=!1;null===D||void 0===D||D.map((function(e){var r,a;ue?null!==e&&void 0!==e&&null!==(r=e.originFileObj)&&void 0!==r&&r.uid?(t=!0,n.append("media",null===e||void 0===e?void 0:e.originFileObj),B(!1),V(D)):(t=!1,V(D),B(!0)):(t=!0,n.append("media",null===(a=D[0])||void 0===a?void 0:a.originFileObj))})),t&&!te&&$({url:"/medias",formData:n}),R(e)},onFinishFailed:function(e){console.log("Failed:",e)},autoComplete:"off",children:[(0,I.jsx)(l.Z,{gutter:20,children:(0,I.jsx)(d.Z,{span:12,children:(0,I.jsx)(s.Z.Item,{label:"\u0418\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435 \u043b\u043e\u0433\u043e\u0442\u0438\u043f\u0430",name:"mediaId",rules:[{required:!0,message:"\u0422\u0440\u0435\u0431\u0443\u0435\u0442\u0441\u044f \u0437\u0430\u0433\u0440\u0443\u0437\u043a\u0430 \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u044f \u043b\u043e\u0433\u043e\u0442\u0438\u043f\u0430"}],children:(0,I.jsx)(v.Z,{rotationSlider:!0,children:(0,I.jsx)(f.Z,{maxCount:2,fileList:D,listType:"picture-card",onChange:function(e){var t=e.fileList;P(t),n.setFieldsValue({mediaId:t})},onPreview:ge,beforeUpload:function(){return!1},onRemove:function(e){ue&&_(e)},children:D.length>1?"":"Upload"})})})})}),(0,I.jsx)(m.Z,{type:"primary",htmlType:"submit",style:{width:"100%"},children:ue?"Edit":"Add"})]})})}}}]);
//# sourceMappingURL=312.e0666d05.chunk.js.map