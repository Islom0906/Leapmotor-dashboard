"use strict";(self.webpackChunkcrema=self.webpackChunkcrema||[]).push([[9],{68438:function(e,t,n){n.d(t,{Z:function(){return s}});var r=n(74165),a=n(15861),i=n(74569),u=n.n(i);u().defaults.baseURL="".concat("https://leapmotorca.uz/api"),u().interceptors.request.use((function(e){var t=function(e){try{return localStorage.getItem(e)}catch(t){console.log("Error getting data")}}("lptoken"),n=null!==t?"Bearer ".concat(t):"";return e.headers.authorization=n,e}));var o=u(),s={getData:function(e){return(0,a.Z)((0,r.Z)().mark((function t(){var n,a;return(0,r.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,o.get(e);case 2:return n=t.sent,a=n.data,t.abrupt("return",a);case 5:case"end":return t.stop()}}),t)})))()},getDataByID:function(e,t){return(0,a.Z)((0,r.Z)().mark((function n(){var a,i;return(0,r.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,o.get("".concat(e,"/").concat(t));case 2:return a=n.sent,i=a.data,n.abrupt("return",i);case 5:case"end":return n.stop()}}),n)})))()},postData:function(e,t){return(0,a.Z)((0,r.Z)().mark((function n(){var a,i;return(0,r.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,o.post(e,t);case 2:return a=n.sent,i=a.data,n.abrupt("return",i);case 5:case"end":return n.stop()}}),n)})))()},editData:function(e,t,n){return(0,a.Z)((0,r.Z)().mark((function a(){var i,u;return(0,r.Z)().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,o.put("".concat(e,"/").concat(n),t);case 2:return i=r.sent,u=i.data,r.abrupt("return",u);case 5:case"end":return r.stop()}}),a)})))()},deleteData:function(e,t){return(0,a.Z)((0,r.Z)().mark((function n(){return(0,r.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,o.delete("".concat(e,"/").concat(t));case 2:case"end":return n.stop()}}),n)})))()},deleteImages:function(e,t){return(0,a.Z)((0,r.Z)().mark((function n(){return(0,r.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return console.log("delete image",t),n.next=3,o.delete(e,{ids:["64f0ffa5883c58f0433c44d9"]});case 3:case"end":return n.stop()}}),n)})))()}}},9:function(e,t,n){n.r(t);var r=n(74165),a=n(15861),i=n(29439),u=n(72791),o=n(2409),s=n(50419),l=n(66106),c=n(30914),d=n(49389),f=n(93086),m=n(87309),v=n(22645),p=n(91933),Z=n(68438),g=n(32179),h=n(57689),x=n(16030),w=n(77221),b=n(80184),j={titleRu:"",titleUz:"",mediaId:""};t.default=function(){var e=o.Z.useForm(),t=(0,i.Z)(e,1)[0],n=(0,h.s0)(),I=(0,x.v9)((function(e){return e.editData})).editId,F=(0,x.I0)(),S=(0,u.useState)([]),E=(0,i.Z)(S,2),y=E[0],D=E[1],P=(0,u.useState)({}),k=(0,i.Z)(P,2),R=k[0],U=k[1],L=(0,u.useState)(!1),z=(0,i.Z)(L,2),V=z[0],C=z[1],O=(0,u.useState)({}),q=(0,i.Z)(O,2),M=q[0],T=q[1],J=(0,p.useMutation)((function(e){var t=e.url,n=e.data;return Z.Z.postData(t,n)}),{onSuccess:function(){return s.ZP.success("Success")},onError:function(e){return s.ZP.error(e.message)}}),B=J.mutate,G=J.data,N=J.isLoading,_=J.isSuccess,A=J.error,Q=J.isError,H=(0,p.useMutation)((function(e){var t=e.url,n=e.formData;return Z.Z.postData(t,n)}),{onError:function(e){return s.ZP.error(e.message,"Rasmning JPG,JPEG,PNG formatlariga ruxsat etilgan")}}),W=H.mutate,K=H.data,X=H.isLoading,Y=H.isSuccess,$=(0,p.useQuery)(["edit-filial",I],(function(){return Z.Z.getDataByID("/filial",I)}),{enabled:!1}),ee=$.isLoading,te=$.data,ne=$.refetch,re=$.isSuccess,ae=(0,p.useMutation)((function(e){var t=e.url,n=e.data,r=e.id;return Z.Z.editData(t,n,r)}),{onError:function(e){return s.ZP.error(e.message)}}),ie=ae.mutate,ue=ae.isLoading,oe=ae.data,se=ae.isSuccess,le=ae.error,ce=ae.isError,de=(0,p.useMutation)((function(e){var t=e.url,n=e.ids;return Z.Z.deleteImages(t,n)}),{onSuccess:function(){return s.ZP.success("Success")},onError:function(e){return s.ZP.error(e.message)}}).mutate;(0,u.useEffect)((function(){var e=[];(se&&F({type:w.Pb,payload:""}),re&&null!==M&&void 0!==M&&M.uid&&e.push(null===M||void 0===M?void 0:M.uid),re&&null!==M&&void 0!==M&&M.uid)&&de({url:"/medias",ids:{ids:e}});(_||se)&&n("/filial")}),[G,oe]),(0,u.useEffect)((function(){Q&&s.ZP.error(A.message),ce&&s.ZP.error(le.message)}),[A,le]),(0,u.useEffect)((function(){""!==I&&ne()}),[I]),(0,u.useEffect)((function(){""===I&&t.setFieldsValue(j)}),[]),(0,u.useEffect)((function(){var e,n,r,a=[{uid:null===te||void 0===te||null===(e=te.image)||void 0===e?void 0:e._id,name:null===te||void 0===te||null===(n=te.image)||void 0===n?void 0:n.name,status:"done",url:"".concat("https://leapmotorca.uz/api","/").concat(null===te||void 0===te||null===(r=te.image)||void 0===r?void 0:r.path)}];if(re){var i={titleRu:null===te||void 0===te?void 0:te.titleRu,titleUz:null===te||void 0===te?void 0:te.titleUz,mediaId:a};D(a),t.setFieldsValue(i)}}),[te]),(0,u.useEffect)((function(){var e,t,n,r,a="";if(re&&Y&&null!==(e=y[0])&&void 0!==e&&null!==(t=e.originFileObj)&&void 0!==t&&t.uid)a=null===(n=K[0])||void 0===n?void 0:n._id;else if(re){var i;a=null===(i=y[0])||void 0===i?void 0:i.uid}!re&&K&&(a=null===(r=K[0])||void 0===r?void 0:r._id);var u={titleRu:R.titleRu,titleUz:R.titleUz,mediaId:a};Y&&!re?B({url:"/filial",data:u}):(V||Y)&&ie({url:"/filial",data:u,id:I})}),[K,R]);(0,u.useEffect)((function(){var e=JSON.parse(localStorage.getItem("myFormValues"));e&&(e.images=[],t.setFieldsValue(e));var n=function(){localStorage.setItem("myFormValues",JSON.stringify(t.getFieldsValue()))};return window.addEventListener("beforeunload",n),function(){localStorage.removeItem("editDataId"),localStorage.removeItem("myFormValues"),window.removeEventListener("beforeunload",n)}}),[]);var fe=function(){var e=(0,a.Z)((0,r.Z)().mark((function e(t){var n,a,i;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.url){e.next=5;break}return e.next=4,new Promise((function(e){var n=new FileReader;n.readAsDataURL(t.originFileObj),n.onload=function(){return e(n.result)}}));case 4:n=e.sent;case 5:(a=new Image).src=n,null===(i=window.open(n))||void 0===i||i.document.write(a.outerHTML);case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return(0,b.jsx)("div",{children:X||N||ee||ue?(0,b.jsx)(g.QP,{}):(0,b.jsxs)(o.Z,{form:t,name:"basic",labelCol:{span:24},wrapperCol:{span:24},style:{maxWidth:"100%"},initialValues:j,onFinish:function(e){var t,n,r,a,i=new FormData,u=!1;re?null!==(t=y[0])&&void 0!==t&&null!==(n=t.originFileObj)&&void 0!==n&&n.uid?(u=!0,i.append("media",null===(r=y[0])||void 0===r?void 0:r.originFileObj),C(!1)):(u=!1,C(!0)):(u=!0,i.append("media",null===(a=y[0])||void 0===a?void 0:a.originFileObj));u&&!Y&&W({url:"/medias",formData:i}),U(e)},onFinishFailed:function(e){console.log("Failed:",e)},autoComplete:"off",children:[(0,b.jsxs)(l.Z,{gutter:20,children:[(0,b.jsx)(c.Z,{span:12,children:(0,b.jsx)(o.Z.Item,{label:"\u0422\u0435\u043a\u0441\u0442 Ru",name:"titleRu",rules:[{required:!0,message:"\u0422\u0440\u0435\u0431\u0443\u0435\u0442\u0441\u044f \u0442\u0435\u043a\u0441\u0442 RU!"}],children:(0,b.jsx)(d.Z,{})})}),(0,b.jsx)(c.Z,{span:12,children:(0,b.jsx)(o.Z.Item,{label:"Text Uz",name:"titleUz",rules:[{required:!0,message:"Text kiritish talab qilinadi Ru!"}],children:(0,b.jsx)(d.Z,{})})})]}),(0,b.jsx)(l.Z,{gutter:20,children:(0,b.jsx)(c.Z,{span:12,children:(0,b.jsx)(o.Z.Item,{label:"\u0418\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435 \u043b\u043e\u0433\u043e\u0442\u0438\u043f\u0430",name:"mediaId",rules:[{required:!0,message:"\u0422\u0440\u0435\u0431\u0443\u0435\u0442\u0441\u044f \u0437\u0430\u0433\u0440\u0443\u0437\u043a\u0430 \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u044f \u043b\u043e\u0433\u043e\u0442\u0438\u043f\u0430"}],children:(0,b.jsx)(v.Z,{rotationSlider:!0,children:(0,b.jsx)(f.Z,{maxCount:1,fileList:y,listType:"picture-card",onChange:function(e){var n=e.fileList;D(n),t.setFieldsValue({mediaId:n})},onPreview:fe,beforeUpload:function(){return!1},onRemove:function(e){re&&T(e)},children:y.length>0?"":"Upload"})})})})}),(0,b.jsx)(m.Z,{type:"primary",htmlType:"submit",style:{width:"100%"},children:re?"Edit":"Add"})]})})}}}]);
//# sourceMappingURL=9.1424e154.chunk.js.map