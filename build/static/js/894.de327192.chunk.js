"use strict";(self.webpackChunkcrema=self.webpackChunkcrema||[]).push([[894],{68438:(e,i,a)=>{a.d(i,{Z:()=>d});var t=a(74569),l=a.n(t);l().defaults.baseURL="".concat("https://leapmotorca.uz/api"),l().interceptors.request.use((e=>{const i=(e=>{try{return localStorage.getItem(e)}catch(i){console.log("Error getting data")}})("lptoken"),a=null!==i?"Bearer ".concat(i):"";return e.headers.authorization=a,e}));const o=l(),d={async getData(e){const{data:i}=await o.get(e);return i},async getDataByID(e,i){const{data:a}=await o.get("".concat(e,"/").concat(i));return a},async postData(e,i){const{data:a}=await o.post(e,i);return a},async editData(e,i,a){const{data:t}=await o.put("".concat(e,"/").concat(a),i);return t},async deleteData(e,i){await o.delete("".concat(e,"/").concat(i))},async deleteImages(e,i){await o.delete(e,{data:i})}}},54894:(e,i,a)=>{a.r(i),a.d(i,{default:()=>j});var t=a(72791),l=a(2409),o=a(50419),d=a(66106),n=a(30914),s=a(49389),r=a(93086),u=a(87309),c=a(91933),m=a(68438),v=a(98986),g=a(57689),p=a(16030),f=a(77221),h=a(80184);const x={textRu:"",textUz:"",model:"",mediaLogoId:"",mediaBannerId:""},j=()=>{const[e]=l.Z.useForm(),i=(0,g.s0)(),{editId:a}=(0,p.v9)((e=>e.editData)),j=(0,p.I0)(),[b,Z]=(0,t.useState)([]),[F,I]=(0,t.useState)([]),[w,y]=(0,t.useState)({}),[L,S]=(0,t.useState)(!1),[E,D]=(0,t.useState)({}),[P,O]=(0,t.useState)({}),{mutate:U,data:R,isLoading:z,isSuccess:B,error:V,isError:C}=(0,c.useMutation)((e=>{let{url:i,data:a}=e;return m.Z.postData(i,a)}),{onSuccess:()=>o.ZP.success("Success"),onError:e=>o.ZP.error(e.message)}),{mutate:q,data:_,isLoading:k,isSuccess:M}=(0,c.useMutation)((e=>{let{url:i,formData:a}=e;return m.Z.postData(i,a)}),{onError:e=>o.ZP.error(e.message,"Rasmning JPG,JPEG,PNG formatlariga ruxsat etilgan")}),{isLoading:T,data:J,refetch:G,isSuccess:N}=(0,c.useQuery)(["edit-banner",a],(()=>m.Z.getDataByID("/product",a)),{enabled:!1}),{mutate:A,isLoading:Q,data:H,isSuccess:W,error:K,isError:X}=(0,c.useMutation)((e=>{let{url:i,data:a,id:t}=e;return m.Z.editData(i,a,t)}),{onError:e=>o.ZP.error(e.message)}),{mutate:Y}=(0,c.useMutation)((e=>{let{url:i,ids:a}=e;return m.Z.deleteImages(i,a)}),{onSuccess:()=>o.ZP.success("Success"),onError:e=>o.ZP.error(e.message)});(0,t.useEffect)((()=>{let e=[];if(W&&j({type:f.Pb,payload:""}),N&&null!==E&&void 0!==E&&E.uid&&e.push(null===E||void 0===E?void 0:E.uid),N&&null!==P&&void 0!==P&&P.uid&&e.push(null===P||void 0===P?void 0:P.uid),N&&(null!==E&&void 0!==E&&E.uid||null!==P&&void 0!==P&&P.uid)){Y({url:"/medias",ids:{ids:e}})}(B||W)&&i("/product")}),[R,H]),(0,t.useEffect)((()=>{C&&o.ZP.error(V.message),X&&o.ZP.error(K.message)}),[V,K]),(0,t.useEffect)((()=>{""!==a&&G()}),[a]),(0,t.useEffect)((()=>{""===a&&e.setFieldsValue(x)}),[]),(0,t.useEffect)((()=>{var i,a,t,l,o,d;const n=[{uid:null===J||void 0===J||null===(i=J.imageLogo)||void 0===i?void 0:i._id,name:null===J||void 0===J||null===(a=J.imageLogo)||void 0===a?void 0:a.name,status:"done",url:"".concat("https://leapmotorca.uz/api","/").concat(null===J||void 0===J||null===(t=J.imageLogo)||void 0===t?void 0:t.path)}],s=[{uid:null===J||void 0===J||null===(l=J.imageBanner)||void 0===l?void 0:l._id,name:null===J||void 0===J||null===(o=J.imageBanner)||void 0===o?void 0:o.name,status:"done",url:"".concat("https://leapmotorca.uz/api","/").concat(null===J||void 0===J||null===(d=J.imageBanner)||void 0===d?void 0:d.path)}];if(N){const i={textRu:null===J||void 0===J?void 0:J.textRu,textUz:null===J||void 0===J?void 0:J.textUz,model:null===J||void 0===J?void 0:J.model,mediaLogoId:n,mediaBannerId:s};Z(n),I(s),e.setFieldsValue(i)}}),[J]),(0,t.useEffect)((()=>{var e,i,t,l;let o="",d="";var n,s,r,u,c;if(N&&M&&null!==(e=b[0])&&void 0!==e&&null!==(i=e.originFileObj)&&void 0!==i&&i.uid)o=null===(n=_[0])||void 0===n?void 0:n._id;else if(N){var m;o=null===(m=b[0])||void 0===m?void 0:m.uid}if(N&&M&&null!==(t=F[0])&&void 0!==t&&null!==(l=t.originFileObj)&&void 0!==l&&l.uid)d=2===_.length?null===(s=_[1])||void 0===s?void 0:s._id:null===(r=_[0])||void 0===r?void 0:r._id;else if(N){var v;d=null===(v=F[0])||void 0===v?void 0:v.uid}!N&&_&&(o=null===(u=_[0])||void 0===u?void 0:u._id,d=null===(c=_[1])||void 0===c?void 0:c._id);const g={textRu:w.textRu,textUz:w.textUz,model:w.model,mediaLogoId:o,mediaBannerId:d};M&&!N?U({url:"/product",data:g}):(L||M)&&A({url:"/product",data:g,id:a})}),[_,w]);(0,t.useEffect)((()=>{const i=JSON.parse(localStorage.getItem("myFormValues"));i&&(i.images=[],e.setFieldsValue(i));const a=()=>{localStorage.setItem("myFormValues",JSON.stringify(e.getFieldsValue()))};return window.addEventListener("beforeunload",a),()=>{localStorage.removeItem("editDataId"),localStorage.removeItem("myFormValues"),window.removeEventListener("beforeunload",a)}}),[]);const $=async e=>{let i=e.url;i||(i=await new Promise((i=>{const a=new FileReader;a.readAsDataURL(e.originFileObj),a.onload=()=>i(a.result)})));const a=new Image;a.src=i;const t=window.open(i);null===t||void 0===t||t.document.write(a.outerHTML)};return(0,h.jsx)("div",{children:k||z||T||Q?(0,h.jsx)(v.QP,{}):(0,h.jsxs)(l.Z,{form:e,name:"basic",labelCol:{span:24},wrapperCol:{span:24},style:{maxWidth:"100%"},initialValues:x,onFinish:e=>{const i=new FormData;let a=!1;var t,l,o,d,n,s,r,u,c,m,v,g;if(N)if(null!==(t=b[0])&&void 0!==t&&null!==(l=t.originFileObj)&&void 0!==l&&l.uid&&null!==(o=F[0])&&void 0!==o&&null!==(d=o.originFileObj)&&void 0!==d&&d.uid)a=!0,i.append("media",null===(c=b[0])||void 0===c?void 0:c.originFileObj),i.append("media",null===(m=F[0])||void 0===m?void 0:m.originFileObj),S(!1);else if(null!==(n=b[0])&&void 0!==n&&null!==(s=n.originFileObj)&&void 0!==s&&s.uid){var p;a=!0,i.append("media",null===(p=b[0])||void 0===p?void 0:p.originFileObj),S(!1)}else if(null!==(r=F[0])&&void 0!==r&&null!==(u=r.originFileObj)&&void 0!==u&&u.uid){var f;a=!0,i.append("media",null===(f=F[0])||void 0===f?void 0:f.originFileObj),S(!1)}else a=!1,S(!0);else a=!0,i.append("media",null===(v=b[0])||void 0===v?void 0:v.originFileObj),i.append("media",null===(g=F[0])||void 0===g?void 0:g.originFileObj);a&&!M&&q({url:"/medias",formData:i}),y(e)},onFinishFailed:e=>{console.log("Failed:",e)},autoComplete:"off",children:[(0,h.jsxs)(d.Z,{gutter:20,children:[(0,h.jsx)(n.Z,{span:12,children:(0,h.jsx)(l.Z.Item,{label:"\u0422\u0435\u043a\u0441\u0442 Ru",name:"textRu",rules:[{required:!0,message:"\u0422\u0440\u0435\u0431\u0443\u0435\u0442\u0441\u044f \u0442\u0435\u043a\u0441\u0442 RU!"}],children:(0,h.jsx)(s.default,{})})}),(0,h.jsx)(n.Z,{span:12,children:(0,h.jsx)(l.Z.Item,{label:"Text Uz",name:"textUz",rules:[{required:!0,message:"Text kiritish talab qilinadi Uz!"}],children:(0,h.jsx)(s.default,{})})})]}),(0,h.jsx)(d.Z,{gutter:20,children:(0,h.jsx)(n.Z,{span:24,children:(0,h.jsx)(l.Z.Item,{label:"Model",name:"model",rules:[{required:!0,message:"\u0422\u0440\u0435\u0431\u0443\u0435\u0442\u0441\u044f \u0432\u0432\u043e\u0434 \u043c\u043e\u0434\u0435\u043b\u0438"}],children:(0,h.jsx)(s.default,{})})})}),(0,h.jsxs)(d.Z,{gutter:20,children:[(0,h.jsx)(n.Z,{span:12,children:(0,h.jsx)(l.Z.Item,{label:"\u0418\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435 \u043b\u043e\u0433\u043e\u0442\u0438\u043f\u0430",name:"mediaLogoId",rules:[{required:!0,message:"\u0422\u0440\u0435\u0431\u0443\u0435\u0442\u0441\u044f \u0437\u0430\u0433\u0440\u0443\u0437\u043a\u0430 \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u044f \u043b\u043e\u0433\u043e\u0442\u0438\u043f\u0430"}],children:(0,h.jsx)(r.Z,{maxCount:1,fileList:b,listType:"picture-card",onChange:i=>{let{fileList:a}=i;Z(a),e.setFieldsValue({mediaLogoId:a})},onPreview:$,beforeUpload:()=>!1,onRemove:e=>{N&&D(e)},children:b.length>0?"":"Upload"})})}),(0,h.jsx)(n.Z,{span:12,children:(0,h.jsx)(l.Z.Item,{label:"\u0418\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435 \u0431\u0430\u043d\u043d\u0435\u0440\u0430",name:"mediaBannerId",rules:[{required:!0,message:"\u0422\u0440\u0435\u0431\u0443\u0435\u0442\u0441\u044f \u0437\u0430\u0433\u0440\u0443\u0437\u043a\u0430 \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u044f \u0431\u0430\u043d\u043d\u0435\u0440\u0430"}],children:(0,h.jsx)(r.Z,{maxCount:1,fileList:F,listType:"picture-card",onChange:i=>{let{fileList:a}=i;I(a),e.setFieldsValue({mediaBannerId:a})},onPreview:$,beforeUpload:()=>!1,onRemove:e=>{N&&O(e)},children:F.length>0?"":"Upload"})})})]}),(0,h.jsx)(u.Z,{type:"primary",htmlType:"submit",style:{width:"100%"},children:N?"Edit":"Add"})]})})}}}]);
//# sourceMappingURL=894.de327192.chunk.js.map