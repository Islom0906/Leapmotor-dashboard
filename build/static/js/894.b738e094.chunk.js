"use strict";(self.webpackChunkcrema=self.webpackChunkcrema||[]).push([[894],{68438:function(e,n,t){t.d(n,{Z:function(){return l}});var r=t(74165),i=t(15861),a=t(74569),o=t.n(a);o().defaults.baseURL="".concat("https://leapmotorca.uz/api"),o().interceptors.request.use((function(e){var n=function(e){try{return localStorage.getItem(e)}catch(n){console.log("Error getting data")}}("lptoken"),t=null!==n?"Bearer ".concat(n):"";return e.headers.authorization=t,e}));var u=o(),l={getData:function(e){return(0,i.Z)((0,r.Z)().mark((function n(){var t,i;return(0,r.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,u.get(e);case 2:return t=n.sent,i=t.data,n.abrupt("return",i);case 5:case"end":return n.stop()}}),n)})))()},getDataByID:function(e,n){return(0,i.Z)((0,r.Z)().mark((function t(){var i,a;return(0,r.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,u.get("".concat(e,"/").concat(n));case 2:return i=t.sent,a=i.data,t.abrupt("return",a);case 5:case"end":return t.stop()}}),t)})))()},postData:function(e,n){return(0,i.Z)((0,r.Z)().mark((function t(){var i,a;return(0,r.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,u.post(e,n);case 2:return i=t.sent,a=i.data,t.abrupt("return",a);case 5:case"end":return t.stop()}}),t)})))()},editData:function(e,n,t){return(0,i.Z)((0,r.Z)().mark((function i(){var a,o;return(0,r.Z)().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,u.put("".concat(e,"/").concat(t),n);case 2:return a=r.sent,o=a.data,r.abrupt("return",o);case 5:case"end":return r.stop()}}),i)})))()},deleteData:function(e,n){return(0,i.Z)((0,r.Z)().mark((function t(){return(0,r.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,u.delete("".concat(e,"/").concat(n));case 2:case"end":return t.stop()}}),t)})))()},deleteImages:function(e,n){return(0,i.Z)((0,r.Z)().mark((function t(){return(0,r.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return console.log("delete image",n),t.next=3,u.delete(e,{ids:["64f0ffa5883c58f0433c44d9"]});case 3:case"end":return t.stop()}}),t)})))()}}},54894:function(e,n,t){t.r(n);var r=t(74165),i=t(15861),a=t(29439),o=t(72791),u=t(2409),l=t(50419),d=t(66106),s=t(30914),c=t(49389),v=t(93086),f=t(87309),m=t(22645),p=t(91933),g=t(68438),Z=t(98986),x=t(57689),h=t(16030),b=t(77221),j=t(80184),w={textRu:"",textUz:"",model:"",mediaLogoId:"",mediaBannerId:""};n.default=function(){var e=u.Z.useForm(),n=(0,a.Z)(e,1)[0],t=(0,x.s0)(),F=(0,h.v9)((function(e){return e.editData})).editId,I=(0,h.I0)(),L=(0,o.useState)([]),S=(0,a.Z)(L,2),y=S[0],E=S[1],D=(0,o.useState)([]),P=(0,a.Z)(D,2),O=P[0],U=P[1],k=(0,o.useState)({}),R=(0,a.Z)(k,2),z=R[0],B=R[1],V=(0,o.useState)(!1),C=(0,a.Z)(V,2),q=C[0],_=C[1],M=(0,o.useState)({}),T=(0,a.Z)(M,2),J=T[0],G=T[1],N=(0,o.useState)({}),A=(0,a.Z)(N,2),Q=A[0],H=A[1],W=(0,p.useMutation)((function(e){var n=e.url,t=e.data;return g.Z.postData(n,t)}),{onSuccess:function(){return l.ZP.success("Success")},onError:function(e){return l.ZP.error(e.message)}}),K=W.mutate,X=W.data,Y=W.isLoading,$=W.isSuccess,ee=W.error,ne=W.isError,te=(0,p.useMutation)((function(e){var n=e.url,t=e.formData;return g.Z.postData(n,t)}),{onError:function(e){return l.ZP.error(e.message,"Rasmning JPG,JPEG,PNG formatlariga ruxsat etilgan")}}),re=te.mutate,ie=te.data,ae=te.isLoading,oe=te.isSuccess,ue=(0,p.useQuery)(["edit-banner",F],(function(){return g.Z.getDataByID("/product",F)}),{enabled:!1}),le=ue.isLoading,de=ue.data,se=ue.refetch,ce=ue.isSuccess,ve=(0,p.useMutation)((function(e){var n=e.url,t=e.data,r=e.id;return g.Z.editData(n,t,r)}),{onError:function(e){return l.ZP.error(e.message)}}),fe=ve.mutate,me=ve.isLoading,pe=ve.data,ge=ve.isSuccess,Ze=ve.error,xe=ve.isError,he=(0,p.useMutation)((function(e){var n=e.url,t=e.ids;return g.Z.deleteImages(n,t)}),{onSuccess:function(){return l.ZP.success("Success")},onError:function(e){return l.ZP.error(e.message)}}).mutate;(0,o.useEffect)((function(){var e=[];(ge&&I({type:b.Pb,payload:""}),ce&&null!==J&&void 0!==J&&J.uid&&e.push(null===J||void 0===J?void 0:J.uid),ce&&null!==Q&&void 0!==Q&&Q.uid&&e.push(null===Q||void 0===Q?void 0:Q.uid),ce&&(null!==J&&void 0!==J&&J.uid||null!==Q&&void 0!==Q&&Q.uid))&&he({url:"/medias",ids:{ids:e}});($||ge)&&t("/product")}),[X,pe]),(0,o.useEffect)((function(){ne&&l.ZP.error(ee.message),xe&&l.ZP.error(Ze.message)}),[ee,Ze]),(0,o.useEffect)((function(){""!==F&&se()}),[F]),(0,o.useEffect)((function(){""===F&&n.setFieldsValue(w)}),[]),(0,o.useEffect)((function(){var e,t,r,i,a,o,u=[{uid:null===de||void 0===de||null===(e=de.imageLogo)||void 0===e?void 0:e._id,name:null===de||void 0===de||null===(t=de.imageLogo)||void 0===t?void 0:t.name,status:"done",url:"".concat("https://leapmotorca.uz/api","/").concat(null===de||void 0===de||null===(r=de.imageLogo)||void 0===r?void 0:r.path)}],l=[{uid:null===de||void 0===de||null===(i=de.imageBanner)||void 0===i?void 0:i._id,name:null===de||void 0===de||null===(a=de.imageBanner)||void 0===a?void 0:a.name,status:"done",url:"".concat("https://leapmotorca.uz/api","/").concat(null===de||void 0===de||null===(o=de.imageBanner)||void 0===o?void 0:o.path)}];if(ce){var d={textRu:null===de||void 0===de?void 0:de.textRu,textUz:null===de||void 0===de?void 0:de.textUz,model:null===de||void 0===de?void 0:de.model,mediaLogoId:u,mediaBannerId:l};E(u),U(l),n.setFieldsValue(d)}}),[de]),(0,o.useEffect)((function(){var e,n,t,r,i,a,o,u,l,d="",s="";if(ce&&oe&&null!==(e=y[0])&&void 0!==e&&null!==(n=e.originFileObj)&&void 0!==n&&n.uid)d=null===(i=ie[0])||void 0===i?void 0:i._id;else if(ce){var c;d=null===(c=y[0])||void 0===c?void 0:c.uid}if(ce&&oe&&null!==(t=O[0])&&void 0!==t&&null!==(r=t.originFileObj)&&void 0!==r&&r.uid)s=2===ie.length?null===(a=ie[1])||void 0===a?void 0:a._id:null===(o=ie[0])||void 0===o?void 0:o._id;else if(ce){var v;s=null===(v=O[0])||void 0===v?void 0:v.uid}!ce&&ie&&(d=null===(u=ie[0])||void 0===u?void 0:u._id,s=null===(l=ie[1])||void 0===l?void 0:l._id);var f={textRu:z.textRu,textUz:z.textUz,model:z.model,mediaLogoId:d,mediaBannerId:s};oe&&!ce?K({url:"/product",data:f}):(q||oe)&&fe({url:"/product",data:f,id:F})}),[ie,z]);(0,o.useEffect)((function(){var e=JSON.parse(localStorage.getItem("myFormValues"));e&&(e.images=[],n.setFieldsValue(e));var t=function(){localStorage.setItem("myFormValues",JSON.stringify(n.getFieldsValue()))};return window.addEventListener("beforeunload",t),function(){localStorage.removeItem("editDataId"),localStorage.removeItem("myFormValues"),window.removeEventListener("beforeunload",t)}}),[]);var be=function(){var e=(0,i.Z)((0,r.Z)().mark((function e(n){var t,i,a;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=n.url){e.next=5;break}return e.next=4,new Promise((function(e){var t=new FileReader;t.readAsDataURL(n.originFileObj),t.onload=function(){return e(t.result)}}));case 4:t=e.sent;case 5:(i=new Image).src=t,null===(a=window.open(t))||void 0===a||a.document.write(i.outerHTML);case 9:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}();return(0,j.jsx)("div",{children:ae||Y||le||me?(0,j.jsx)(Z.QP,{}):(0,j.jsxs)(u.Z,{form:n,name:"basic",labelCol:{span:24},wrapperCol:{span:24},style:{maxWidth:"100%"},initialValues:w,onFinish:function(e){var n,t,r,i,a,o,u,l,d,s,c,v,f=new FormData,m=!1;if(ce)if(null!==(n=y[0])&&void 0!==n&&null!==(t=n.originFileObj)&&void 0!==t&&t.uid&&null!==(r=O[0])&&void 0!==r&&null!==(i=r.originFileObj)&&void 0!==i&&i.uid)m=!0,f.append("media",null===(d=y[0])||void 0===d?void 0:d.originFileObj),f.append("media",null===(s=O[0])||void 0===s?void 0:s.originFileObj),_(!1);else if(null!==(a=y[0])&&void 0!==a&&null!==(o=a.originFileObj)&&void 0!==o&&o.uid){var p;m=!0,f.append("media",null===(p=y[0])||void 0===p?void 0:p.originFileObj),_(!1)}else if(null!==(u=O[0])&&void 0!==u&&null!==(l=u.originFileObj)&&void 0!==l&&l.uid){var g;m=!0,f.append("media",null===(g=O[0])||void 0===g?void 0:g.originFileObj),_(!1)}else m=!1,_(!0);else m=!0,f.append("media",null===(c=y[0])||void 0===c?void 0:c.originFileObj),f.append("media",null===(v=O[0])||void 0===v?void 0:v.originFileObj);m&&!oe&&re({url:"/medias",formData:f}),B(e)},onFinishFailed:function(e){console.log("Failed:",e)},autoComplete:"off",children:[(0,j.jsxs)(d.Z,{gutter:20,children:[(0,j.jsx)(s.Z,{span:12,children:(0,j.jsx)(u.Z.Item,{label:"\u0422\u0435\u043a\u0441\u0442 Ru",name:"textRu",rules:[{required:!0,message:"\u0422\u0440\u0435\u0431\u0443\u0435\u0442\u0441\u044f \u0442\u0435\u043a\u0441\u0442 RU!"}],children:(0,j.jsx)(c.Z,{})})}),(0,j.jsx)(s.Z,{span:12,children:(0,j.jsx)(u.Z.Item,{label:"Text Uz",name:"textUz",rules:[{required:!0,message:"Text kiritish talab qilinadi Uz!"}],children:(0,j.jsx)(c.Z,{})})})]}),(0,j.jsx)(d.Z,{gutter:20,children:(0,j.jsx)(s.Z,{span:24,children:(0,j.jsx)(u.Z.Item,{label:"Model",name:"model",rules:[{required:!0,message:"\u0422\u0440\u0435\u0431\u0443\u0435\u0442\u0441\u044f \u0432\u0432\u043e\u0434 \u043c\u043e\u0434\u0435\u043b\u0438"}],children:(0,j.jsx)(c.Z,{})})})}),(0,j.jsxs)(d.Z,{gutter:20,children:[(0,j.jsx)(s.Z,{span:12,children:(0,j.jsx)(u.Z.Item,{label:"\u0418\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435 \u043b\u043e\u0433\u043e\u0442\u0438\u043f\u0430",name:"mediaLogoId",rules:[{required:!0,message:"\u0422\u0440\u0435\u0431\u0443\u0435\u0442\u0441\u044f \u0437\u0430\u0433\u0440\u0443\u0437\u043a\u0430 \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u044f \u043b\u043e\u0433\u043e\u0442\u0438\u043f\u0430"}],children:(0,j.jsx)(m.Z,{children:(0,j.jsx)(v.Z,{maxCount:1,fileList:y,listType:"picture-card",onChange:function(e){var t=e.fileList;E(t),n.setFieldsValue({mediaLogoId:t})},onPreview:be,beforeUpload:function(){return!1},onRemove:function(e){ce&&G(e)},children:y.length>0?"":"Upload"})})})}),(0,j.jsx)(s.Z,{span:12,children:(0,j.jsx)(u.Z.Item,{label:"\u0418\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435 \u0431\u0430\u043d\u043d\u0435\u0440\u0430",name:"mediaBannerId",rules:[{required:!0,message:"\u0422\u0440\u0435\u0431\u0443\u0435\u0442\u0441\u044f \u0437\u0430\u0433\u0440\u0443\u0437\u043a\u0430 \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u044f \u0431\u0430\u043d\u043d\u0435\u0440\u0430"}],children:(0,j.jsx)(m.Z,{rotate:!0,children:(0,j.jsx)(v.Z,{maxCount:1,fileList:O,listType:"picture-card",onChange:function(e){var t=e.fileList;U(t),n.setFieldsValue({mediaBannerId:t})},onPreview:be,beforeUpload:function(){return!1},onRemove:function(e){ce&&H(e)},children:O.length>0?"":"Upload"})})})})]}),(0,j.jsx)(f.Z,{type:"primary",htmlType:"submit",style:{width:"100%"},children:ce?"Edit":"Add"})]})})}}}]);
//# sourceMappingURL=894.b738e094.chunk.js.map